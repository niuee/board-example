(()=>{"use strict";function t(t,i){return e(t,i)||void 0===i||(i.max&&(t=Math.min(i.max,t)),i.min&&(t=Math.max(i.min,t))),t}function e(t,e){return void 0===e||!(t<=0||void 0!==e&&(void 0!==e.max&&e.max<t||void 0!==e.min&&e.min>t))}class i{static addVector(t,e){return null==t.z&&null==e.z?{x:t.x+e.x,y:t.y+e.y}:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z})}static subVector(t,e){return null==t.z&&null==e.z?{x:t.x-e.x,y:t.y-e.y}:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z})}static multiplyVectorByScalar(t,e){return null==t.z?{x:t.x*e,y:t.y*e}:{x:t.x*e,y:t.y*e,z:t.z*e}}static divideVectorByScalar(t,e){return 0==e?{x:t.x,y:t.y}:null==t.z?{x:t.x/e,y:t.y/e}:{x:t.x/e,y:t.y/e,z:t.z/e}}static magnitude(t){return null==t.z&&(t.z=0),Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static unitVector(t){return null==t.z&&(t.z=0),0!=this.magnitude(t)?{x:t.x/this.magnitude(t),y:t.y/this.magnitude(t),z:t.z/this.magnitude(t)}:{x:0,y:0,z:0}}static dotProduct(t,e){return null==t.z&&null==e.z?t.x*e.x+t.y*e.y:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),t.x*e.x+t.y*e.y+t.z*e.z)}static crossProduct(t,e){return null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}static unitVectorFromA2B(t,e){return this.unitVector(this.subVector(e,t))}static rotatePoint(t,e){return{x:t.x*Math.cos(e)-t.y*Math.sin(e),y:t.x*Math.sin(e)+t.y*Math.cos(e)}}static transform2NewAxis(t,e){return{x:t.x*Math.cos(e)+t.y*Math.sin(e),y:-t.x*Math.sin(e)+t.y*Math.cos(e)}}static angleFromA2B(t,e){return Math.atan2(t.x*e.y-t.y*e.x,t.x*e.x+t.y*e.y)}static transformPointWRTAnchor(t,e,i){let r=this.rotatePoint(this.subVector(t,e),i);return this.addVector(r,e)}static distanceBetweenPoints(t,e){return this.magnitude(this.subVector(t,e))}static flipYAxis(t){return{x:t.x,y:-t.y,z:t.z}}static linearInterpolation(t,e,i){return null==t.z||null==e.z?{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}:{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i,z:t.z+(e.z-t.z)*i}}static isEqual(t,e){return null==t.z&&(t.z=0),null==e.z&&(e.z=0),t.x==e.x&&t.y==e.y&&t.z==e.z}static getLineIntersection(t,e,r,n){const a=(n.x-r.x)*(t.y-r.y)-(n.y-r.y)*(t.x-r.x),o=(n.y-r.y)*(e.x-t.x)-(n.x-r.x)*(e.y-t.y);if(0===o)return{intersects:!1};const s=a/o;return s>=0&&s<=1?{intersects:!0,intersection:i.linearInterpolation(t,e,s),offset:s}:{intersects:!1}}}function r(t,e,r,n,a,o){let s={x:r/2,y:n/2},l=i.subVector(e,s);return l=i.multiplyVectorByScalar(l,1/a),l=i.rotatePoint(l,o),i.addVector(t,l)}function n(t,e,r,n,a,o){let s={x:e/2,y:r/2},l=i.subVector(t,s);return l=i.multiplyVectorByScalar(l,1/a),l=i.rotatePoint(l,o),i.addVector(n,l)}function a(t,e){if(null==e)return!0;let i=!1,r=!1,n=!1,a=!1;return(null==e.max||null==e.max.x||t.x<=e.max.x)&&(r=!0),(null==e.min||null==e.min.x||t.x>=e.min.x)&&(i=!0),(null==e.max||null==e.max.y||t.y<=e.max.y)&&(n=!0),(null==e.min||null==e.min.y||t.y>=e.min.y)&&(a=!0),i&&r&&n&&a}function o(t,e){if(a(t,e)||null==e)return t;let i={x:t.x,y:t.y},r=e.min;return null!=r&&(null!=r.x&&(i.x=Math.max(i.x,r.x)),null!=r.y&&(i.y=Math.max(i.y,r.y))),r=e.max,null!=r&&(null!=r.x&&(i.x=Math.min(i.x,r.x)),null!=r.y&&(i.y=Math.min(i.y,r.y))),i}function s(t){if(null!=t&&null!=t.min&&null!=t.max&&null!=t.min.x&&null!=t.max.x)return t.max.x-t.min.x}function l(t){if(null!=t&&null!=t.min&&null!=t.max&&null!=t.min.y&&null!=t.max.y)return t.max.y-t.min.y}function h(t,e,n,a,s,l){if(null==a)return t;let h=r(t,{x:0,y:n},e,n,s,l),c=r(t,{x:0,y:0},e,n,s,l),u=r(t,{x:e,y:n},e,n,s,l),d=r(t,{x:e,y:0},e,n,s,l),m=o(h,a),y=o(u,a),p=o(c,a),v=o(d,a),b=[i.subVector(m,h),i.subVector(y,u),i.subVector(p,c),i.subVector(v,d)],x=Math.abs(b[0].x),_=Math.abs(b[0].y),g=b[0];return b.forEach((t=>{Math.abs(t.x)>x&&(x=Math.abs(t.x),g.x=t.x),Math.abs(t.y)>_&&(_=Math.abs(t.y),g.y=t.y)})),i.addVector(t,g)}function c(t,e){if(u(t,e)||void 0===e)return t;t=d(t);const i=m(e.start,t),r=m(e.end,t);return e.ccw&&(i<0||r>0)||!e.ccw&&(i>0||r<0)?Math.abs(i)===Math.abs(r)?e.startAsTieBreaker?e.start:e.end:Math.abs(i)<Math.abs(r)?e.start:e.end:t}function u(t,e){if(void 0===e)return!0;const i=m(e.start,t),r=m(e.end,t);return!(e.ccw&&(i<0||r>0)||!e.ccw&&(i>0||r<0))}function d(t){return((t%=2*Math.PI)+2*Math.PI)%(2*Math.PI)}function m(t,e){t=d(t);let i=(e=d(e))-t;return i>Math.PI&&(i=-(2*Math.PI-i)),i<-Math.PI&&(i+=2*Math.PI),i}class y{constructor(t=void 0){this._nextHandler=t}set nextHandler(t){this._nextHandler=t}get nextHandler(){return this._nextHandler}chainHandler(t){return this._nextHandler=t,t}panCameraTo(t,e){this._nextHandler&&this._nextHandler.panCameraTo(t,e)}panCameraBy(t,e){this._nextHandler&&this._nextHandler.panCameraBy(t,e)}}class p extends y{constructor(t=void 0){super(t)}panCameraTo(t,e){t.setPosition(e)}panCameraBy(t,e){t.setPosition(i.addVector(t.position,e))}}class v extends y{constructor(t=void 0){super(t),this._entireViewPort=!1}set entireViewPort(t){this._entireViewPort=t}get entireViewPort(){return this._entireViewPort}panCameraTo(t,e){let i=o(e,t.boundaries);this._entireViewPort&&(i=h(e,t.viewPortWidth,t.viewPortHeight,t.boundaries,t.zoomLevel,t.rotation)),super.panCameraTo(t,i)}panCameraBy(t,e){let r=i.subVector(o(i.addVector(t.position,e),t.boundaries),t.position);this._entireViewPort&&(r=i.subVector(h(i.addVector(t.position,e),t.viewPortWidth,t.viewPortHeight,t.boundaries,t.zoomLevel,t.rotation),t.position)),super.panCameraBy(t,r)}}class b extends y{constructor(t=void 0){super(t),this._restrictXTranslation=!1,this._restrictYTranslation=!1,this._restrictRelativeXTranslation=!1,this._restrictRelativeYTranslation=!1}set restrictXTranslation(t){this._restrictXTranslation=t}get restrictXTranslation(){return this._restrictXTranslation}set restrictYTranslation(t){this._restrictYTranslation=t}get restrictYTranslation(){return this._restrictYTranslation}set restrictRelativeXTranslation(t){this._restrictRelativeXTranslation=t}get restrictRelativeXTranslation(){return this._restrictRelativeXTranslation}set restrictRelativeYTranslation(t){this._restrictRelativeYTranslation=t}get restrictRelativeYTranslation(){return this._restrictRelativeYTranslation}convertDeltaToComplyWithRestriction(t,e){if(this._restrictXTranslation&&this._restrictYTranslation)return{x:0,y:0};if(this._restrictRelativeXTranslation&&this._restrictRelativeYTranslation)return{x:0,y:0};if(this._restrictXTranslation&&(e.x=0),this._restrictYTranslation&&(e.y=0),this._restrictRelativeXTranslation){const r=i.rotatePoint({x:0,y:1},t.rotation),n=i.dotProduct(r,e);e=i.multiplyVectorByScalar(r,n)}if(this._restrictRelativeYTranslation){const r=i.rotatePoint({x:1,y:0},t.rotation),n=i.dotProduct(r,e);e=i.multiplyVectorByScalar(r,n)}return e}panCameraTo(t,e){let r=i.subVector(e,t.position);if(r=this.convertDeltaToComplyWithRestriction(t,r),0===r.x&&0===r.y)return;const n=i.addVector(t.position,r);super.panCameraTo(t,n)}panCameraBy(t,e){e=this.convertDeltaToComplyWithRestriction(t,e),super.panCameraBy(t,e)}}class x extends y{set restrictRelativeXTranslation(t){this.restrictionHandler.restrictRelativeXTranslation=t}set restrictRelativeYTranslation(t){this.restrictionHandler.restrictRelativeYTranslation=t}set restrictXTranslation(t){this.restrictionHandler.restrictXTranslation=t}set restrictYTranslation(t){this.restrictionHandler.restrictYTranslation=t}set restrictTranslation(t){this.restrictionHandler.restrictXTranslation=t,this.restrictionHandler.restrictYTranslation=t}get restrictTranslation(){return this.restrictionHandler.restrictXTranslation}get restrictXTranslation(){return this.restrictionHandler.restrictXTranslation}get restrictYTranslation(){return this.restrictionHandler.restrictYTranslation}get restrictRelativeXTranslation(){return this.restrictionHandler.restrictRelativeXTranslation}get restrictRelativeYTranslation(){return this.restrictionHandler.restrictRelativeYTranslation}set limitEntireViewPort(t){this.clampHandler.entireViewPort=t}get limitEntireViewPort(){return this.clampHandler.entireViewPort}constructor(){super(),this.baseHandler=new p,this.clampHandler=new v,this.restrictionHandler=new b,this.restrictionHandler.chainHandler(this.clampHandler).chainHandler(this.baseHandler),this.nextHandler=this.restrictionHandler}}class _{constructor(t=void 0){this._nextHandler=t}set nextHandler(t){this._nextHandler=t}get nextHandler(){return this._nextHandler}chainHandler(t){return this._nextHandler=t,t}rotateCameraTo(t,e){this._nextHandler&&this._nextHandler.rotateCameraTo(t,e)}rotateCameraBy(t,e){this._nextHandler&&this._nextHandler.rotateCameraBy(t,e)}}class g extends _{constructor(t=void 0){super()}rotateCameraTo(t,e){e=d(e),t.setRotation(e)}rotateCameraBy(t,e){const i=t.rotation,r=d(i+e);e=m(i,r),t.setRotation(r)}}class z extends _{constructor(t=void 0){super(t),this._restrictRotation=!1}get restrictRotation(){return this._restrictRotation}set restrictRotation(t){this._restrictRotation=t}rotateCameraBy(t,e){this._restrictRotation||super.rotateCameraBy(t,e)}rotateCameraTo(t,e){this._restrictRotation||super.rotateCameraTo(t,e)}}class C extends _{constructor(t=void 0){super(t)}rotateCameraBy(t,e){const i=t.rotation;let r=d(i+e);r=c(r,t.rotationBoundaries),e=m(i,r),super.rotateCameraBy(t,e)}rotateCameraTo(t,e){e=c(e=d(e),t.rotationBoundaries),super.rotateCameraTo(t,e)}}class T extends _{get restrictRotation(){return this._restrictionHandler.restrictRotation}set restrictRotation(t){this._restrictionHandler.restrictRotation=t}constructor(t=void 0){super(t),this._baseHandler=new g,this._clampHandler=new C(this._baseHandler),this._restrictionHandler=new z(this._clampHandler)}rotateCameraBy(t,e){this._restrictionHandler.rotateCameraBy(t,e),super.rotateCameraBy(t,e)}rotateCameraTo(t,e){this._restrictionHandler.rotateCameraTo(t,e),super.rotateCameraTo(t,e)}}class f{constructor(t=void 0){this._nextHandler=t}set nextHandler(t){this._nextHandler=t}get nextHandler(){return this._nextHandler}chainHandler(t){return this._nextHandler=t,t}zoomCameraTo(t,e){this._nextHandler&&this._nextHandler.zoomCameraTo(t,e)}zoomCameraBy(t,e){this._nextHandler&&this._nextHandler.zoomCameraBy(t,e)}zoomCameraToAt(t,e,i){this._nextHandler&&this._nextHandler.zoomCameraToAt(t,e,i)}zoomCameraByAt(t,e,i){this._nextHandler&&this._nextHandler.zoomCameraByAt(t,e,i)}}class w extends f{constructor(t,e=void 0){super(e),this.panHandler=t}set nextHandler(t){this._nextHandler=void 0}zoomCameraTo(t,e){t.setZoomLevel(e)}zoomCameraBy(t,e){const i=t.zoomLevel+e;t.setZoomLevel(i)}zoomCameraToAt(t,e,r){let a=n(r,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);t.zoomLevel,t.setZoomLevel(e);let o=n(r,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);const s=i.subVector(a,o);this.panHandler.panCameraBy(t,s)}zoomCameraByAt(t,e,r){let a=n(r,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);const o=t.zoomLevel+e;t.setZoomLevel(o);let s=n(r,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);const l=i.subVector(a,s);this.panHandler.panCameraBy(t,l)}}class H extends f{constructor(t=void 0){super(t)}zoomCameraTo(e,i){i=t(i,e.zoomBoundaries),super.zoomCameraTo(e,i)}zoomCameraBy(e,i){let r=e.zoomLevel+i;r=t(r,e.zoomBoundaries),i=r-e.zoomLevel,super.zoomCameraBy(e,i)}zoomCameraToAt(e,i,r){i=t(i,e.zoomBoundaries),super.zoomCameraToAt(e,i,r)}zoomByAt(e,i,r){let n=e.zoomLevel+i;n=t(n,e.zoomBoundaries),i=n-e.zoomLevel,super.zoomCameraByAt(e,i,r)}}class P extends f{constructor(t=void 0){super(t),this._restrictZoom=!1}set restrictZoom(t){this._restrictZoom=t}get restrictZoom(){return this._restrictZoom}zoomCameraTo(t,e){this._restrictZoom||super.zoomCameraTo(t,e)}zoomCameraBy(t,e){this._restrictZoom||super.zoomCameraBy(t,e)}zoomCameraToAt(t,e,i){this._restrictZoom||super.zoomCameraToAt(t,e,i)}zoomCameraByAt(t,e,i){this._restrictZoom||super.zoomCameraByAt(t,e,i)}}class S extends f{constructor(t,e=void 0){super(e),this._baseHandler=new w(t),this._clampHandler=new H,this._restrictionHandler=new P,this._restrictionHandler.chainHandler(this._clampHandler).chainHandler(this._baseHandler),this._nextHandler=this._restrictionHandler}set restrictZoom(t){this._restrictionHandler.restrictZoom=t}get restrictZoom(){return this._restrictionHandler.restrictZoom}zoomCameraTo(t,e){super.zoomCameraTo(t,e)}zoomCameraBy(t,e){super.zoomCameraBy(t,e)}zoomCameraByAt(t,e,i){super.zoomCameraByAt(t,e,i)}zoomCameraToAt(t,e,i){super.zoomCameraToAt(t,e,i)}}function M(t,e,i,r){return new(i||(i=Promise))((function(n,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class B{constructor(){this.panCallbackList=[],this.zoomCallbackList=[],this.rotateCallbackList=[]}notifyPositionChange(t,e){return M(this,void 0,void 0,(function*(){queueMicrotask((()=>{this.panCallbackList.forEach((i=>{i({diff:t},e)}))}))}))}notifyZoomChange(t,e){return M(this,void 0,void 0,(function*(){return new Promise(((i,r)=>{this.zoomCallbackList.forEach((i=>{i({deltaZoomAmount:t},e)})),i()}))}))}notifyRotationChange(t,e){return M(this,void 0,void 0,(function*(){return new Promise(((i,r)=>{this.rotateCallbackList.forEach((i=>{i({deltaRotation:t},e)})),i()}))}))}on(t,e){switch(t){case"pan":return this.panCallbackList.push(e),()=>{this.panCallbackList=this.panCallbackList.filter((t=>t!==e))};case"zoom":return this.zoomCallbackList.push(e),()=>{this.zoomCallbackList=this.zoomCallbackList.filter((t=>t!==e))};case"rotate":return this.rotateCallbackList.push(e),()=>{this.rotateCallbackList=this.rotateCallbackList.filter((t=>t!==e))}}return()=>{}}clearCallbacks(){this.panCallbackList=[],this.zoomCallbackList=[],this.rotateCallbackList=[]}}class k{constructor(t=new B,e={x:0,y:0},i=1e3,r=1e3,n=1,a=0){this._position=e,this._zoomLevel=n,this._rotation=a,this._viewPortHeight=r,this._viewPortWidth=i,this._observer=t}get boundaries(){return this._boundaries}set boundaries(t){this._boundaries=t}get viewPortWidth(){return this._viewPortWidth}set viewPortWidth(t){this._viewPortWidth=t}get viewPortHeight(){return this._viewPortHeight}set viewPortHeight(t){this._viewPortHeight=t}get position(){return this._position}get observer(){return this._observer}setPosition(t){if(a(t,this._boundaries)){const e=i.subVector(t,this._position);if(i.magnitude(e)<1e-9&&i.magnitude(e)<1/this._zoomLevel)return;this._position=t,this._observer.notifyPositionChange(e,{position:this._position,rotation:this._rotation,zoomLevel:this._zoomLevel})}}get zoomLevel(){return this._zoomLevel}get zoomBoundaries(){return this._zoomBoundaries}set zoomBoundaries(t){if(void 0!==t&&void 0!==t.min&&void 0!==t.max&&t.min>t.max){let e=t.max;t.max=t.min,t.min=e}this._zoomBoundaries=t}setMaxZoomLevel(t){return null==this._zoomBoundaries&&(this._zoomBoundaries={min:void 0,max:void 0}),!(null!=this._zoomBoundaries.min&&this._zoomBoundaries.min>t||this._zoomLevel>t||(this._zoomBoundaries.max=t,0))}setMinZoomLevel(t){return null==this._zoomBoundaries&&(this._zoomBoundaries={min:void 0,max:void 0}),!(null!=this._zoomBoundaries.max&&this._zoomBoundaries.max<t||(this._zoomBoundaries.min=t,this._zoomLevel<t&&(this._zoomLevel=t),0))}setZoomLevel(i){if(e(i,this._zoomBoundaries)){if(void 0!==this._zoomBoundaries&&void 0!==this._zoomBoundaries.max&&t(i,this._zoomBoundaries)==this._zoomBoundaries.max&&this._zoomLevel==this._zoomBoundaries.max)return;if(void 0!==this._zoomBoundaries&&void 0!==this._zoomBoundaries.min&&t(i,this._zoomBoundaries)==this._zoomBoundaries.min&&this._zoomLevel==this._zoomBoundaries.min)return;const e=this._zoomLevel;this._zoomLevel=i,this._observer.notifyZoomChange(this._zoomLevel-e,{position:this._position,rotation:this._rotation,zoomLevel:this._zoomLevel})}}get rotation(){return this._rotation}get rotationBoundaries(){return this._rotationBoundaries}set rotationBoundaries(t){if(void 0!==t&&void 0!==t.start&&void 0!==t.end&&t.start>t.end){let e=t.end;t.end=t.start,t.start=e}this._rotationBoundaries=t}setRotation(t){if(u(t,this._rotationBoundaries)){if(t=d(t),void 0!==this._rotationBoundaries&&void 0!==this._rotationBoundaries.end&&c(t,this._rotationBoundaries)==this._rotationBoundaries.end&&this._rotation==this._rotationBoundaries.end)return;if(void 0!==this._rotationBoundaries&&void 0!==this.rotationBoundaries.start&&c(t,this._rotationBoundaries)==this._rotationBoundaries.start&&this._rotation==this._rotationBoundaries.start)return;this._observer.notifyRotationChange(t-this._rotation,{position:this._position,rotation:t,zoomLevel:this._zoomLevel}),this._rotation=t}}convertFromViewPort2WorldSpace(t){return n(t,this._viewPortWidth,this._viewPortHeight,this._position,this._zoomLevel,this._rotation)}invertFromWorldSpace2ViewPort(t){let e={x:this.viewPortWidth/2,y:this._viewPortHeight/2},r=i.subVector(t,this._position);return r=i.rotatePoint(r,-this._rotation),r=i.multiplyVectorByScalar(r,this._zoomLevel),i.addVector(e,r)}setHorizontalBoundaries(t,e){if(t>e){let i=e;e=t,t=i}null==this._boundaries&&(this._boundaries={min:{x:void 0,y:void 0},max:{x:void 0,y:void 0}}),this._boundaries.min.x=t,this._boundaries.max.x=e}setVerticalBoundaries(t,e){if(t>e){let i=e;e=t,t=i}null==this._boundaries&&(this._boundaries={min:{x:void 0,y:void 0},max:{x:void 0,y:void 0}}),this._boundaries.min.y=t,this._boundaries.max.y=e}on(t,e){return this._observer.on(t,e)}}class O{constructor(t,e,i,r=!1,n=!0){this._panDisabled=!1,this._zoomDisabled=!1,this._rotateDisabled=!1,this._keyController=new Map,this.SCROLL_SENSATIVITY=.005,this.isDragging=!1,this._canvas=t,this._camera=e,this._debugMode=r,this._alignCoordinateSystem=n,this.bindFunctions(),this.inputObserver=i}get debugMode(){return this._debugMode}set debugMode(t){this._debugMode=t}get alignCoordinateSystem(){return this._alignCoordinateSystem}set alignCoordinateSystem(t){this._alignCoordinateSystem=t}get panDisabled(){return this._panDisabled}set panDisabled(t){this._panDisabled=t,t&&(this.canvas.style.cursor="auto",this.isDragging=!1,this.dragStartPoint={x:0,y:0})}get zoomDisabled(){return this._zoomDisabled}set zoomDisabled(t){this._zoomDisabled=t}get rotateDisabled(){return this._rotateDisabled}set rotateDisabled(t){this._rotateDisabled=t}get camera(){return this._camera}set camera(t){this._camera=t}get canvas(){return this._canvas}setUp(){this.canvas.addEventListener("pointerdown",this.pointerDownHandler),this.canvas.addEventListener("pointerup",this.pointerUpHandler),this.canvas.addEventListener("pointermove",this.pointerMoveHandler),this.canvas.addEventListener("wheel",this.scrollHandler),window.addEventListener("keydown",this.keypressHandler),window.addEventListener("keyup",this.keyupHandler),this.setupKeyController([" "])}tearDown(){this.canvas.removeEventListener("pointerdown",this.pointerDownHandler),this.canvas.removeEventListener("pointerup",this.pointerUpHandler),this.canvas.removeEventListener("pointermove",this.pointerMoveHandler),this.canvas.removeEventListener("wheel",this.scrollHandler),window.removeEventListener("keydown",this.keypressHandler),window.removeEventListener("keyup",this.keyupHandler)}bindFunctions(){this.pointerDownHandler=this.pointerDownHandler.bind(this),this.pointerUpHandler=this.pointerUpHandler.bind(this),this.pointerMoveHandler=this.pointerMoveHandler.bind(this),this.scrollHandler=this.scrollHandler.bind(this),this.keypressHandler=this.keypressHandler.bind(this),this.keyupHandler=this.keyupHandler.bind(this)}setupKeyController(t){t.forEach((t=>{this._keyController.set(t,!1)}))}pointerDownHandler(t){this._disabled||"mouse"!==t.pointerType||1!=t.button&&!t.metaKey&&!this._keyController.get(" ")||this._panDisabled||(this.isDragging=!0,this.dragStartPoint={x:t.clientX,y:t.clientY})}disableStrategy(){this.isDragging=!1,this.dragStartPoint={x:0,y:0},this._disabled=!0}enableStrategy(){this._disabled=!1}pointerUpHandler(t){this._disabled||"mouse"===t.pointerType&&(this.isDragging&&(this.isDragging=!1),this._debugMode?this.canvas.style.cursor="none":this.canvas.style.cursor="auto")}pointerMoveHandler(t){if(!this._disabled&&"mouse"==t.pointerType&&this.isDragging&&!this._panDisabled){this._debugMode?this.canvas.style.cursor="none":this.canvas.style.cursor="grabbing";const e={x:t.clientX,y:t.clientY};let r=i.subVector(this.dragStartPoint,e);this._alignCoordinateSystem||(r=i.flipYAxis(r));let n=i.rotatePoint(r,this._camera.rotation);n=i.multiplyVectorByScalar(n,1/this._camera.zoomLevel),this.inputObserver.notifyOnPan(this._camera,n),this.dragStartPoint=e}}scrollHandler(t){if(this._disabled)return;t.preventDefault();const e=t.deltaY*this.SCROLL_SENSATIVITY;if(t.ctrlKey){if(this._zoomDisabled)return;const r={x:t.clientX,y:t.clientY};let n=i.subVector(r,{x:this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().top});this._alignCoordinateSystem||(n=i.subVector(r,{x:this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().bottom}),n=i.flipYAxis(n)),this.inputObserver.notifyOnZoom(this._camera,-this._camera.zoomLevel*e*5,n)}else{if(this._panDisabled)return;let e={x:t.deltaX,y:t.deltaY};this._alignCoordinateSystem||(e=i.flipYAxis(e));let r=i.rotatePoint(e,this._camera.rotation);r=i.multiplyVectorByScalar(r,1/this._camera.zoomLevel),this.inputObserver.notifyOnPan(this._camera,r)}}keypressHandler(t){this._keyController.has(t.key)&&0==this._keyController.get(t.key)&&(t.preventDefault(),this._keyController.set(t.key,!0))}keyupHandler(t){this._keyController.has(t.key)&&1==this._keyController.get(t.key)&&(t.preventDefault(),this._keyController.set(t.key,!1),this.isDragging=!1,this.canvas.style.cursor="auto")}updateCamera(t){this._camera=t}get disabled(){return this._disabled}}class V{constructor(t,e,i,r=!0){this._panDisabled=!1,this._zoomDisabled=!1,this._rotateDisabled=!1,this.isDragging=!1,this.ZOOM_SENSATIVITY=.005,this.panInputCallBackList=[],this.zoomInputCallBackList=[],this.controlCamera=e,this.canvas=t,this._disabled=!1,this.touchPoints=[],this.zoomStartDist=0,this.isDragging=!1,this.dragStartPoint={x:0,y:0},this._alignCoordinateSystem=r,this.inputObserver=i,this.bindListeners()}bindListeners(){this.touchstartHandler=this.touchstartHandler.bind(this),this.touchendHandler=this.touchendHandler.bind(this),this.touchcancelHandler=this.touchcancelHandler.bind(this),this.touchmoveHandler=this.touchmoveHandler.bind(this)}resetAttributes(){this.touchPoints=[],this.zoomStartDist=0,this.isDragging=!1,this.dragStartPoint=null,this.tapPoint=null}enableStrategy(){this._disabled=!1}disableStrategy(){this.resetAttributes(),this._disabled=!0}setUp(){this.canvas.addEventListener("touchstart",this.touchstartHandler),this.canvas.addEventListener("touchend",this.touchendHandler),this.canvas.addEventListener("touchcancel",this.touchcancelHandler),this.canvas.addEventListener("touchmove",this.touchmoveHandler)}tearDown(){this.resetAttributes(),this.canvas.removeEventListener("touchstart",this.touchstartHandler),this.canvas.removeEventListener("touchend",this.touchendHandler),this.canvas.removeEventListener("touchcancel",this.touchcancelHandler),this.canvas.removeEventListener("touchmove",this.touchmoveHandler)}get disabled(){return this._disabled}get alignCoordinateSystem(){return this._alignCoordinateSystem}set alignCoordinateSystem(t){this._alignCoordinateSystem=t}get panDisabled(){return this._panDisabled}set panDisabled(t){this._panDisabled=t}get zoomDisabled(){return this._zoomDisabled}set zoomDisabled(t){this._zoomDisabled=t}get rotateDisabled(){return this._rotateDisabled}set rotateDisabled(t){this._rotateDisabled=t}get camera(){return this.controlCamera}set camera(t){this.controlCamera=t}updateCamera(t){this.controlCamera=t}touchstartHandler(t){if(!this._disabled)if(t.preventDefault(),2===t.targetTouches.length){this.isDragging=!1;let e={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY},r={x:t.targetTouches[1].clientX,y:t.targetTouches[1].clientY};this.zoomStartDist=i.distanceBetweenPoints(e,r),this.touchPoints=[e,r]}else 1===t.targetTouches.length&&(this.tapPoint={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY},this.tapPoint=this.controlCamera.convertFromViewPort2WorldSpace(this.convertWindowPoint2ViewPortPoint({x:this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().top},this.tapPoint)),this.isDragging=!0,this.dragStartPoint={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY})}touchcancelHandler(t){this._disabled||(this.isDragging=!1,this.touchPoints=[])}touchendHandler(t){this._disabled||(this.isDragging=!1,this.touchPoints=[])}touchmoveHandler(t){if(!this._disabled)if(t.preventDefault(),2==t.targetTouches.length&&2==this.touchPoints.length){if(this._zoomDisabled)return;let e={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY},r={x:t.targetTouches[1].clientX,y:t.targetTouches[1].clientY},n=i.distanceBetweenPoints(e,r),a=this.zoomStartDist-n,o=i.linearInterpolation(e,r,.5);o=this._alignCoordinateSystem?this.convertWindowPoint2ViewPortPoint({x:this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().top},o):this.convertWindowPoint2ViewPortPoint({x:this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().bottom},o);let s=.1*a*this.controlCamera.zoomLevel*this.ZOOM_SENSATIVITY;this.inputObserver.notifyOnZoom(this.controlCamera,-s,o),this.touchPoints=[e,r],this.tapPoint=null}else if(1==t.targetTouches.length&&this.isDragging&&!this._panDisabled){let e={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY},r=i.subVector(this.dragStartPoint,e);this._alignCoordinateSystem||(r=i.flipYAxis(r));let n=i.rotatePoint(r,this.controlCamera.rotation);n=i.multiplyVectorByScalar(n,1/this.controlCamera.zoomLevel),this.inputObserver.notifyOnPan(this.controlCamera,n),this.dragStartPoint=e,this.tapPoint=null}}convertWindowPoint2ViewPortPoint(t,e){const r=i.subVector(e,t);return this._alignCoordinateSystem?{x:r.x,y:r.y}:{x:r.x,y:-r.y}}}function L(t,e){return null!=e&&(null==t||e!=1/0&&void 0!==t&&(null==t.min||e>t.min))}function I(t,e,i,r){const n=s(t);if(null==n)return;const a=Math.abs(n*Math.cos(r)),o=Math.abs(n*Math.sin(r));return e/a==1/0?i/o:Math.max(e/a,i/o)}function D(t,e,i,r){const n=l(t);if(null==n)return;const a=e/Math.abs(n*Math.cos(r)),o=i/Math.abs(n*Math.sin(r));return o==1/0?a:Math.max(a,o)}class A{constructor(t){this.cameraSubscribers=[],this.panHandlerSubscribers=[],this.zoomHandlerSubscribers=[],this.rotationHandlerSubscribers=[],this._camera=t}subscribeToCamera(t){this.cameraSubscribers.push(t)}unsubscribeToCamera(t){this.cameraSubscribers=this.cameraSubscribers.filter((e=>e!==t))}subscribeToPanHandler(t){this.panHandlerSubscribers.push(t)}unsubscribeToPanHandler(t){this.panHandlerSubscribers=this.panHandlerSubscribers.filter((e=>e!==t))}subscribeToZoomHandler(t){this.zoomHandlerSubscribers.push(t)}unsubscribeToZoomHandler(t){this.zoomHandlerSubscribers=this.zoomHandlerSubscribers.filter((e=>e!==t))}subscribeToRotationHandler(t){return this.rotationHandlerSubscribers.push(t),()=>{this.rotationHandlerSubscribers=this.rotationHandlerSubscribers.filter((e=>e!==t))}}get camera(){return this._camera}set camera(t){this._camera=t,this.notifyCameraChange()}get panHandler(){return this._panHandler}set panHandler(t){this._panHandler=t,this.notifyPanHandlerChange()}get zoomHandler(){return this._zoomHandler}set zoomHandler(t){this._zoomHandler=t,this.notifyZoomHandlerChange()}get rotationHandler(){return this._rotationHandler}set rotationHandler(t){this._rotationHandler=t,this.notifyRotationHandlerChange()}notifyCameraChange(){this.cameraSubscribers.forEach((t=>t.updateCamera(this._camera)))}notifyPanHandlerChange(){this.panHandlerSubscribers.forEach((t=>t.updatePanHandler(this._panHandler)))}notifyZoomHandlerChange(){this.zoomHandlerSubscribers.forEach((t=>t.updateZoomHandler(this._zoomHandler)))}notifyRotationHandlerChange(){this.rotationHandlerSubscribers.forEach((t=>t.updateRotationHandler(this._rotationHandler)))}}class R{constructor(t){this.panCallbackList=[],this.zoomCallbackList=[],this.rotateCallbackList=[],this._controlCenter=t}notifyOnPan(t,e){this._controlCenter.notifyPanInput(t,e),this.panCallbackList.forEach((t=>{queueMicrotask((()=>{t({diff:e})}))}))}notifyOnZoom(t,e,i){this._controlCenter.notifyZoomInput(t,e,i),this.zoomCallbackList.forEach((t=>{queueMicrotask((()=>{t({deltaZoomAmount:e,anchorPoint:i})}))}))}notifyOnRotation(t,e){this._controlCenter.notifyRotationInput(t,e),this.rotateCallbackList.forEach((t=>{queueMicrotask((()=>{t({deltaRotation:e})}))}))}onInput(t,e){switch(t){case"pan":return this.panCallbackList.push(e),()=>{this.panCallbackList=this.panCallbackList.filter((t=>t!==e))};case"zoom":return this.zoomCallbackList.push(e),()=>{this.zoomCallbackList=this.zoomCallbackList.filter((t=>t!==e))};case"rotate":return this.rotateCallbackList.push(e),()=>{this.rotateCallbackList=this.rotateCallbackList.filter((t=>t!==e))};default:throw new Error("Invalid input event name")}}get controlCenter(){return this._controlCenter}set controlCenter(t){this._controlCenter=t}}class E{constructor(t,e,i){this._panController=t,this._zoomController=e,this._rotationController=i}get panController(){return this._panController}get zoomController(){return this._zoomController}get rotationController(){return this._rotationController}notifyPanInput(t,e){this._panController.panCameraBy(t,e)}notifyZoomInput(t,e,i){this._zoomController.zoomCameraToAt(t,t.zoomLevel+e,i)}notifyRotationInput(t,e){this._rotationController.rotateCameraBy(t,e)}}function Y(t){return null!=t&&null!=t.max&&null!=t.min&&null!=t.max.x&&null!=t.max.y&&null!=t.min.x&&null!=t.min.y}function Z(t){if(null!=t&&null!=t.min&&null!=t.max&&null!=t.min.x&&null!=t.max.x)return t.max.x-t.min.x}function W(t){if(null!=t&&null!=t.min&&null!=t.max&&null!=t.min.y&&null!=t.max.y)return t.max.y-t.min.y}function X(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}function F(t){return t}Object.freeze({__proto__:null,easeInBack:function(t){return 2.70158*t*t*t-1.70158*t*t},easeInBounce:function(t){return 1-X(1-t)},easeInCirc:function(t){return 1-Math.sqrt(1-Math.pow(t,2))},easeInCubic:function(t){return t*t*t},easeInElastic:function(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*e)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*t-10)},easeInOutBack:function(t){const e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2},easeInOutBounce:function(t){return t<.5?(1-X(1-2*t))/2:(1+X(2*t-1))/2},easeInOutCirc:function(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2},easeInOutCubic:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2},easeInOutElastic:function(t){const e=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1},easeInOutExpo:function(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2},easeInOutQuad:function(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2},easeInOutSine:function(t){return-(Math.cos(Math.PI*t)-1)/2},easeInQuad:function(t){return t*t},easeInQuart:function(t){return t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeInSine:function(t){return 1-Math.cos(t*Math.PI/2)},easeOutBack:function(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)},easeOutBounce:X,easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeOutCubic:function(t){return 1-Math.pow(1-t,3)},easeOutElastic:function(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},easeOutQuad:function(t){return 1-(1-t)*(1-t)},easeOutQuart:function(t){return 1-Math.pow(1-t,4)},easeOutQuint:function(t){return 1-Math.pow(1-t,5)},easeOutSine:function(t){return Math.sin(t*Math.PI/2)},linear:F});class U{static addVector(t,e){return null==t.z&&null==e.z?{x:t.x+e.x,y:t.y+e.y}:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z})}static subVector(t,e){return null==t.z&&null==e.z?{x:t.x-e.x,y:t.y-e.y}:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z})}static multiplyVectorByScalar(t,e){return null==t.z?{x:t.x*e,y:t.y*e}:{x:t.x*e,y:t.y*e,z:t.z*e}}static divideVectorByScalar(t,e){return 0==e?{x:t.x,y:t.y}:null==t.z?{x:t.x/e,y:t.y/e}:{x:t.x/e,y:t.y/e,z:t.z/e}}static magnitude(t){return null==t.z&&(t.z=0),Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static unitVector(t){return null==t.z&&(t.z=0),0!=this.magnitude(t)?{x:t.x/this.magnitude(t),y:t.y/this.magnitude(t),z:t.z/this.magnitude(t)}:{x:0,y:0,z:0}}static dotProduct(t,e){return null==t.z&&null==e.z?t.x*e.x+t.y*e.y:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),t.x*e.x+t.y*e.y+t.z*e.z)}static crossProduct(t,e){return null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}static unitVectorFromA2B(t,e){return this.unitVector(this.subVector(e,t))}static rotatePoint(t,e){return{x:t.x*Math.cos(e)-t.y*Math.sin(e),y:t.x*Math.sin(e)+t.y*Math.cos(e)}}static transform2NewAxis(t,e){return{x:t.x*Math.cos(e)+t.y*Math.sin(e),y:-t.x*Math.sin(e)+t.y*Math.cos(e)}}static angleFromA2B(t,e){return Math.atan2(t.x*e.y-t.y*e.x,t.x*e.x+t.y*e.y)}static transformPointWRTAnchor(t,e,i){let r=this.rotatePoint(this.subVector(t,e),i);return this.addVector(r,e)}static distanceBetweenPoints(t,e){return this.magnitude(this.subVector(t,e))}static flipYAxis(t){return{x:t.x,y:-t.y,z:t.z}}static linearInterpolation(t,e,i){return null==t.z||null==e.z?{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}:{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i,z:t.z+(e.z-t.z)*i}}}class q{constructor(){}lerp(t,e,i){const r=(t-e.percentage)/(i.percentage-e.percentage);let n=r;return e.easingFn&&(n=e.easingFn(r)),e.value+n*(i.value-e.value)}}class G{constructor(t=new Map,e=!1,i=void 0,r=(()=>{}),n=(()=>{})){this.endCallbacks=[],this.startCallbacks=[],this.animations=t,this._duration=0,this.calculateDuration(),this.localTime=-1,this.onGoing=!1,this.loop=e,this.setUpFn=r,this.tearDownFn=n,this._delayTime=0,this._dragTime=0,this.parent=i,this.animations.forEach((t=>{t.animator.setParent(this)})),this.reverse=!1,this.playedTime=0}toggleReverse(t){this.reverse!=t&&(this.reverse=t,this.animations.forEach((e=>{e.animator.toggleReverse(t)})))}setParent(t){this.parent=t}detachParent(){this.parent=void 0}animate(t){!this.onGoing||this.localTime>this._duration+this._delayTime+this._dragTime||this.localTime<0||0==this.animations.size||(this.localTime+=t,this.localTime-t<=0&&t>0&&this.startCallbacks.forEach((t=>{queueMicrotask((()=>{t()}))})),this.animateChildren(t),this.checkTerminalAndLoop())}checkTerminalAndLoop(){this.localTime>=this._duration+this._delayTime+this._dragTime&&(this.playedTime+=1,this.onGoing=!1,this.endCallbacks.forEach((t=>{queueMicrotask((()=>{t()}))}))),this.localTime>=this._duration+this._delayTime+this._dragTime&&this.loop&&(this.localTime=0,this.onGoing=!0,this.animations.forEach((t=>{t.animator.loops&&t.animator.startAnimation()})))}animateChildren(t){const e=this.localTime-t;this.localTime<this._delayTime||this.animations.forEach(((i,r)=>{null==i.startTime&&(i.startTime=0),this.childShouldAnimate(i,e)?e-this._delayTime<i.startTime?i.animator.animate(this.localTime-this._delayTime-i.startTime):i.animator.animate(t):this.wrapUpAnimator({animator:i.animator,startTime:i.startTime,name:r},e)}))}childShouldAnimate(t,e){return null==t.startTime&&(t.startTime=0),this.localTime-this._delayTime>=t.startTime&&this.localTime-this._delayTime<=t.startTime+t.animator.duration}wrapUpAnimator(t,e){null==t.startTime&&(t.startTime=0),this.localTime-this._delayTime>t.startTime+t.animator.duration&&e-this._delayTime<t.startTime+t.animator.duration&&t.animator.animate(t.startTime+t.animator.duration-(e-this._delayTime))}pauseAnimation(){this.onGoing=!1,this.animations.forEach((t=>{t.animator.pauseAnimation()}))}resumeAnimation(){this.onGoing=!0,this.animations.forEach((t=>{t.animator.resumeAnimation()}))}startAnimation(){this.onGoing=!0,this.setUp(),this.localTime=0,this.animations.forEach((t=>{t.animator.startAnimation()}))}stopAnimation(){this.onGoing=!1,this.localTime=this._duration+.1,this.animations.forEach((t=>{t.animator.stopAnimation()})),this.tearDown()}get duration(){return this._duration+this._delayTime+this._dragTime}set duration(t){if(t<0)return;const e=t/(this._duration+this._delayTime+this._dragTime),i=this._delayTime*e,r=this._dragTime*e;this._delayTime=i,this._dragTime=r,this.animations.forEach((t=>{null==t.startTime&&(t.startTime=0),t.startTime*=e;const i=t.animator.duration*e;t.animator.nonCascadingDuration(i)})),this.calculateDuration(),null!=this.parent&&this.parent.updateDuration()}nonCascadingDuration(t){if(t<0)return;const e=t/(this._duration+this._delayTime+this._dragTime),i=this._delayTime*e,r=this._dragTime*e;this._delayTime=i,this._dragTime=r,this.animations.forEach((t=>{null==t.startTime&&(t.startTime=0),t.startTime*=e;const i=t.animator.duration*e;t.animator.nonCascadingDuration(i)})),this.calculateDuration()}resetAnimationState(){this.onGoing=!1,this.animations.forEach((t=>{t.animator.resetAnimationState()}))}getTrueDuration(){return this._duration}setUp(){this.setUpFn(),this.animations.forEach((t=>{t.animator.setUp()}))}tearDown(){this.tearDownFn(),this.animations.forEach((t=>{t.animator.tearDown()}))}addAnimation(t,e,i=0,r=(()=>{})){if(this.animations.has(t))return;if(void 0!==this.parent&&this.parent.containsAnimation(e))return;this.animations.set(t,{animator:e,startTime:i}),e.setParent(this),this.localTime>i&&e.animate(this.localTime-i);const n=i+e.duration;this._duration=Math.max(this._duration,n),null!=this.parent&&this.parent.updateDuration()}addAnimationAfter(t,e,i,r=0){let n=this.animations.get(i);if(null==n)return;null==n.startTime&&(n.startTime=0);let a=n.startTime+n.animator.duration;a+=r,this.addAnimation(t,e,a),this.calculateDuration(),null!=this.parent&&this.parent.updateDuration()}addAnimationAdmist(t,e,i,r){let n=this.animations.get(i);if(null==n)return;null==n.startTime&&(n.startTime=0);let a=n.startTime+r;this.addAnimation(t,e,a),this.calculateDuration(),null!=this.parent&&this.parent.updateDuration()}addAnimationBefore(t,e,i,r=0){let n=this.animations.get(i);if(null==n)return;null==n.startTime&&(n.startTime=0);let a=n.startTime;if(a-=r,this.addAnimation(t,e,a),a<0){const t=0-a;this.animations.forEach((e=>{null==e.startTime&&(e.startTime=0),e.startTime+=t}))}this.calculateDuration(),null!=this.parent&&this.parent.updateDuration()}removeAnimation(t){let e=this.animations.get(t);this.animations.delete(t)&&(null!=e&&e.animator.detachParent(),this.calculateDuration(),null!=this.parent&&this.parent.updateDuration())}set delay(t){this._delayTime=t,null!=this.parent&&this.parent.updateDuration()}get delay(){return this._delayTime}set drag(t){this._dragTime=t,null!=this.parent&&this.parent.updateDuration()}get drag(){return this._dragTime}removeDelay(){this._delayTime=0,null!=this.parent&&this.parent.updateDuration()}removeDrag(){this._dragTime=0,null!=this.parent&&this.parent.updateDuration()}updateDuration(){this.checkCyclicChildren()||(this.calculateDuration(),null!=this.parent&&this.parent.updateDuration())}calculateDuration(){this._duration=0,this.animations.forEach((t=>{null==t.startTime&&(t.startTime=0);const e=t.startTime+t.animator.duration;this._duration=Math.max(this._duration,e)}))}get loops(){return this.loop}set loops(t){this.loop=t}checkCyclicChildren(){const t=[];t.push(this);const e=new Set;for(;t.length>0;){const i=t.pop();if(null!=i){if(e.has(i))return!0;e.add(i),i instanceof G&&i.animations.forEach((e=>{t.push(e.animator)}))}}return!1}forceToggleLoop(t){this.loop=!0,this.animations.forEach((t=>{t.animator.loops=!0}))}containsAnimation(t){if(void 0!==this.parent)return this.parent.containsAnimation(t);const e=[];e.push(this);const i=new Set;for(;e.length>0;){const r=e.pop();if(null!=r){if(r==t)return!0;i.has(r)||(i.add(r),r instanceof G&&r.animations.forEach((t=>{e.push(t.animator)})))}}return!1}onEnd(t){return this.endCallbacks.push(t),()=>{this.endCallbacks=this.endCallbacks.filter((e=>e!=t))}}onStart(t){return this.startCallbacks.push(t),()=>{this.startCallbacks=this.startCallbacks.filter((e=>e!=t))}}clearOnEnd(){this.endCallbacks=[]}clearOnStart(){this.startCallbacks=[]}get playing(){return this.onGoing}}class K{constructor(t,e,i,r=1e3,n=!1,a=void 0,o=(()=>{}),s=(()=>{}),l=F){this.delayTime=0,this.dragTime=0,this.reverse=!1,this.endCallbacks=[],this.startCallbacks=[],this.startAfterDelayCallbacks=[],this._duration=r,this.keyframes=t,this.animatableAttributeHelper=i,this.applyAnimationValue=e,this.easeFn=l,this.onGoing=!1,this.localTime=r+.1,this.currentKeyframeIndex=0,this.loop=n,this.setUpFn=o,this.tearDownFn=s,this.parent=a,this.playedTime=0,this.zeroPercentageValue=this.findValue(0,t,i)}toggleReverse(t){this.reverse=t}startAnimation(){this.localTime=0,this.currentKeyframeIndex=0,this.onGoing=!0,this.applyAnimationValue(this.zeroPercentageValue),this.setUp()}stopAnimation(){this.onGoing=!1,this.localTime=this._duration+this.dragTime+this.delayTime+.1,this.tearDown()}pauseAnimation(){this.onGoing=!1}resumeAnimation(){this.onGoing=!0}get playing(){return this.onGoing}animate(t){if(!(1!=this.onGoing||this.localTime<0)&&(this.localTime+=t,this.localTime-t<=0&&t>0&&this.startCallbacks.forEach((t=>{queueMicrotask((()=>{t()}))})),this.localTime>=this.delayTime&&(this.localTime<=this.delayTime+this._duration+this.dragTime||this.localTime-t<=this.delayTime+this._duration+this.dragTime))){this.localTime-t<=this.delayTime&&0!==this.delayTime&&t>0&&this.startAfterDelayCallbacks.forEach((t=>{queueMicrotask((()=>{t()}))}));let e,i=(this.localTime-this.delayTime)/this._duration,r=this.easeFn(i);if(i>1&&(r=this.easeFn(1)),e=this.currentKeyframeIndex<this.keyframes.length&&this.currentKeyframeIndex>=0&&(this.reverse?1-this.keyframes[this.currentKeyframeIndex].percentage==r:this.keyframes[this.currentKeyframeIndex].percentage==r)?this.keyframes[this.currentKeyframeIndex].value:this.findValue(r,this.keyframes,this.animatableAttributeHelper),this.reverse)for(;this.currentKeyframeIndex>=0&&1-this.keyframes[this.currentKeyframeIndex].percentage<=r;)this.currentKeyframeIndex-=1;else for(;this.currentKeyframeIndex<this.keyframes.length&&this.keyframes[this.currentKeyframeIndex].percentage<=r;)this.currentKeyframeIndex+=1;this.applyAnimationValue(e),this.localTime>=this._duration+this.dragTime+this.delayTime&&(this.playedTime+=1,this.endCallbacks.forEach((t=>{queueMicrotask((()=>{t()}))})),this.onGoing=!1),this.localTime>=this._duration+this.delayTime+this.dragTime&&this.loop&&(this.localTime=0,this.onGoing=!0,this.currentKeyframeIndex=0)}}findValue(t,e,i){if(t>1)return this.reverse?i.lerp(t,e[1],e[0]):i.lerp(t,e[e.length-2],e[e.length-1]);if(t<0)return this.reverse?i.lerp(t,e[e.length-2],e[e.length-1]):i.lerp(t,e[1],e[0]);let r=0,n=e.length-1;for(;r<=n;){let i=r+Math.floor((n-r)/2);const a=this.reverse?1-e[i].percentage:e[i].percentage;if(a==t)return e[i].value;a<t?this.reverse?n=i-1:r=i+1:this.reverse?r=i+1:n=i-1}r>e.length-1&&(r=e.length-1);const a=this.reverse?{percentage:1-e[r].percentage,value:e[r].value}:e[r-1],o=this.reverse?{percentage:1-e[r-1].percentage,value:e[r-1].value}:e[r];return i.lerp(t,a,o)}setUp(){this.setUpFn()}tearDown(){this.tearDownFn()}get loops(){return this.loop}set loops(t){this.loop=t}get duration(){return this._duration+this.delayTime+this.dragTime}set duration(t){if(t<0)return;const e=t/(this._duration+this.delayTime+this.dragTime),i=this.delayTime*e,r=this.dragTime*e;this.delayTime=i,this.dragTime=r,this._duration=this._duration*e,null!=this.parent&&this.parent.updateDuration()}nonCascadingDuration(t){if(t<0)return;const e=t/(this._duration+this.delayTime+this.dragTime),i=this.delayTime*e,r=this.dragTime*e;this.delayTime=i,this.dragTime=r,this._duration=t}resetAnimationState(){this.onGoing=!1,this.applyAnimationValue(this.keyframes[0].value),this.currentKeyframeIndex=0,this.setUp()}wrapUp(){this.onGoing=!1,this.localTime=this._duration+this.dragTime+this.delayTime+.1,this.currentKeyframeIndex=0}get delay(){return this.delayTime}set delay(t){this.delayTime=t,null!=this.parent&&this.parent.updateDuration()}get drag(){return this.dragTime}set drag(t){this.dragTime=t,null!=this.parent&&this.parent.updateDuration()}get trueDuration(){return this._duration}set trueDuration(t){this._duration=t,null!=this.parent&&this.parent.updateDuration()}setParent(t){this.parent=t}detachParent(){this.parent=void 0}set keyFrames(t){this.keyframes=t}get keyFrames(){return this.keyframes}get easeFunction(){return this.easeFn}set easeFunction(t){this.easeFn=t}onEnd(t){return this.endCallbacks.push(t),()=>{this.endCallbacks=this.endCallbacks.filter((e=>e!=t))}}onStart(t){return this.startCallbacks.push(t),()=>{this.startCallbacks=this.startCallbacks.filter((e=>e!=t))}}onStartAfterDelay(t){return this.startAfterDelayCallbacks.push(t),()=>{this.startAfterDelayCallbacks=this.startAfterDelayCallbacks.filter((e=>e!=t))}}clearOnEnd(){this.endCallbacks=[]}clearOnStart(){this.startCallbacks=[]}}function Q(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}function N(t,e){return function(t,e){return void 0===e||!(t<=0||void 0!==e&&(void 0!==e.max&&e.max<t||void 0!==e.min&&e.min>t))}(t,e)||void 0===e||(e.max&&(t=Math.min(e.max,t)),e.min&&(t=Math.max(e.min,t))),t}class j{static addVector(t,e){return null==t.z&&null==e.z?{x:t.x+e.x,y:t.y+e.y}:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z})}static subVector(t,e){return null==t.z&&null==e.z?{x:t.x-e.x,y:t.y-e.y}:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z})}static multiplyVectorByScalar(t,e){return null==t.z?{x:t.x*e,y:t.y*e}:{x:t.x*e,y:t.y*e,z:t.z*e}}static divideVectorByScalar(t,e){return 0==e?{x:t.x,y:t.y}:null==t.z?{x:t.x/e,y:t.y/e}:{x:t.x/e,y:t.y/e,z:t.z/e}}static magnitude(t){return null==t.z&&(t.z=0),Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static unitVector(t){return null==t.z&&(t.z=0),0!=this.magnitude(t)?{x:t.x/this.magnitude(t),y:t.y/this.magnitude(t),z:t.z/this.magnitude(t)}:{x:0,y:0,z:0}}static dotProduct(t,e){return null==t.z&&null==e.z?t.x*e.x+t.y*e.y:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),t.x*e.x+t.y*e.y+t.z*e.z)}static crossProduct(t,e){return null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}static unitVectorFromA2B(t,e){return this.unitVector(this.subVector(e,t))}static rotatePoint(t,e){return{x:t.x*Math.cos(e)-t.y*Math.sin(e),y:t.x*Math.sin(e)+t.y*Math.cos(e)}}static transform2NewAxis(t,e){return{x:t.x*Math.cos(e)+t.y*Math.sin(e),y:-t.x*Math.sin(e)+t.y*Math.cos(e)}}static angleFromA2B(t,e){return Math.atan2(t.x*e.y-t.y*e.x,t.x*e.x+t.y*e.y)}static transformPointWRTAnchor(t,e,i){let r=this.rotatePoint(this.subVector(t,e),i);return this.addVector(r,e)}static distanceBetweenPoints(t,e){return this.magnitude(this.subVector(t,e))}static flipYAxis(t){return{x:t.x,y:-t.y,z:t.z}}static linearInterpolation(t,e,i){return null==t.z||null==e.z?{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}:{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i,z:t.z+(e.z-t.z)*i}}static isEqual(t,e){return null==t.z&&(t.z=0),null==e.z&&(e.z=0),t.x==e.x&&t.y==e.y&&t.z==e.z}static getLineIntersection(t,e,i,r){const n=(r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x),a=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(0===a)return{intersects:!1};const o=n/a;return o>=0&&o<=1?{intersects:!0,intersection:j.linearInterpolation(t,e,o),offset:o}:{intersects:!1}}}function J(t,e,i,r,n,a){let o={x:i/2,y:r/2},s=j.subVector(e,o);return s=j.multiplyVectorByScalar(s,1/n),s=j.rotatePoint(s,a),j.addVector(t,s)}function $(t,e,i,r,n,a){let o={x:e/2,y:i/2},s=j.subVector(t,o);return s=j.multiplyVectorByScalar(s,1/n),s=j.rotatePoint(s,a),j.addVector(r,s)}function tt(t,e){if(function(t,e){if(null==e)return!0;let i=!1,r=!1,n=!1,a=!1;return(null==e.max||null==e.max.x||t.x<=e.max.x)&&(r=!0),(null==e.min||null==e.min.x||t.x>=e.min.x)&&(i=!0),(null==e.max||null==e.max.y||t.y<=e.max.y)&&(n=!0),(null==e.min||null==e.min.y||t.y>=e.min.y)&&(a=!0),i&&r&&n&&a}(t,e)||null==e)return t;let i={x:t.x,y:t.y},r=e.min;return null!=r&&(null!=r.x&&(i.x=Math.max(i.x,r.x)),null!=r.y&&(i.y=Math.max(i.y,r.y))),r=e.max,null!=r&&(null!=r.x&&(i.x=Math.min(i.x,r.x)),null!=r.y&&(i.y=Math.min(i.y,r.y))),i}function et(t,e,i,r,n,a){if(null==r)return t;let o=J(t,{x:0,y:i},e,i,n,a),s=J(t,{x:0,y:0},e,i,n,a),l=J(t,{x:e,y:i},e,i,n,a),h=J(t,{x:e,y:0},e,i,n,a),c=tt(o,r),u=tt(l,r),d=tt(s,r),m=tt(h,r),y=[j.subVector(c,o),j.subVector(u,l),j.subVector(d,s),j.subVector(m,h)],p=Math.abs(y[0].x),v=Math.abs(y[0].y),b=y[0];return y.forEach((t=>{Math.abs(t.x)>p&&(p=Math.abs(t.x),b.x=t.x),Math.abs(t.y)>v&&(v=Math.abs(t.y),b.y=t.y)})),j.addVector(t,b)}function it(t,e){if(function(t,e){if(void 0===e)return!0;const i=nt(e.start,t),r=nt(e.end,t);return!(e.ccw&&(i<0||r>0)||!e.ccw&&(i>0||r<0))}(t,e)||void 0===e)return t;t=rt(t);const i=nt(e.start,t),r=nt(e.end,t);return e.ccw&&(i<0||r>0)||!e.ccw&&(i>0||r<0)?Math.abs(i)===Math.abs(r)?e.startAsTieBreaker?e.start:e.end:Math.abs(i)<Math.abs(r)?e.start:e.end:t}function rt(t){return((t%=2*Math.PI)+2*Math.PI)%(2*Math.PI)}function nt(t,e){t=rt(t);let i=(e=rt(e))-t;return i>Math.PI&&(i=-(2*Math.PI-i)),i<-Math.PI&&(i+=2*Math.PI),i}class at{constructor(t=void 0){this._nextHandler=t}set nextHandler(t){this._nextHandler=t}get nextHandler(){return this._nextHandler}chainHandler(t){return this._nextHandler=t,t}panCameraTo(t,e){this._nextHandler&&this._nextHandler.panCameraTo(t,e)}panCameraBy(t,e){this._nextHandler&&this._nextHandler.panCameraBy(t,e)}}class ot extends at{constructor(t=void 0){super(t)}panCameraTo(t,e){t.setPosition(e)}panCameraBy(t,e){t.setPosition(j.addVector(t.position,e))}}class st extends at{constructor(t=void 0){super(t),this._entireViewPort=!1}set entireViewPort(t){this._entireViewPort=t}get entireViewPort(){return this._entireViewPort}panCameraTo(t,e){let i=tt(e,t.boundaries);this._entireViewPort&&(i=et(e,t.viewPortWidth,t.viewPortHeight,t.boundaries,t.zoomLevel,t.rotation)),super.panCameraTo(t,i)}panCameraBy(t,e){let i=j.subVector(tt(j.addVector(t.position,e),t.boundaries),t.position);this._entireViewPort&&(i=j.subVector(et(j.addVector(t.position,e),t.viewPortWidth,t.viewPortHeight,t.boundaries,t.zoomLevel,t.rotation),t.position)),super.panCameraBy(t,i)}}class lt extends at{constructor(t=void 0){super(t),this._restrictXTranslation=!1,this._restrictYTranslation=!1,this._restrictRelativeXTranslation=!1,this._restrictRelativeYTranslation=!1}set restrictXTranslation(t){this._restrictXTranslation=t}get restrictXTranslation(){return this._restrictXTranslation}set restrictYTranslation(t){this._restrictYTranslation=t}get restrictYTranslation(){return this._restrictYTranslation}set restrictRelativeXTranslation(t){this._restrictRelativeXTranslation=t}get restrictRelativeXTranslation(){return this._restrictRelativeXTranslation}set restrictRelativeYTranslation(t){this._restrictRelativeYTranslation=t}get restrictRelativeYTranslation(){return this._restrictRelativeYTranslation}convertDeltaToComplyWithRestriction(t,e){if(this._restrictXTranslation&&this._restrictYTranslation)return{x:0,y:0};if(this._restrictRelativeXTranslation&&this._restrictRelativeYTranslation)return{x:0,y:0};if(this._restrictXTranslation&&(e.x=0),this._restrictYTranslation&&(e.y=0),this._restrictRelativeXTranslation){const i=j.rotatePoint({x:0,y:1},t.rotation),r=j.dotProduct(i,e);e=j.multiplyVectorByScalar(i,r)}if(this._restrictRelativeYTranslation){const i=j.rotatePoint({x:1,y:0},t.rotation),r=j.dotProduct(i,e);e=j.multiplyVectorByScalar(i,r)}return e}panCameraTo(t,e){let i=j.subVector(e,t.position);if(i=this.convertDeltaToComplyWithRestriction(t,i),0===i.x&&0===i.y)return;const r=j.addVector(t.position,i);super.panCameraTo(t,r)}panCameraBy(t,e){e=this.convertDeltaToComplyWithRestriction(t,e),super.panCameraBy(t,e)}}class ht extends at{set restrictRelativeXTranslation(t){this.restrictionHandler.restrictRelativeXTranslation=t}set restrictRelativeYTranslation(t){this.restrictionHandler.restrictRelativeYTranslation=t}set restrictXTranslation(t){this.restrictionHandler.restrictXTranslation=t}set restrictYTranslation(t){this.restrictionHandler.restrictYTranslation=t}set restrictTranslation(t){this.restrictionHandler.restrictXTranslation=t,this.restrictionHandler.restrictYTranslation=t}get restrictTranslation(){return this.restrictionHandler.restrictXTranslation}get restrictXTranslation(){return this.restrictionHandler.restrictXTranslation}get restrictYTranslation(){return this.restrictionHandler.restrictYTranslation}get restrictRelativeXTranslation(){return this.restrictionHandler.restrictRelativeXTranslation}get restrictRelativeYTranslation(){return this.restrictionHandler.restrictRelativeYTranslation}set limitEntireViewPort(t){this.clampHandler.entireViewPort=t}get limitEntireViewPort(){return this.clampHandler.entireViewPort}constructor(){super(),this.baseHandler=new ot,this.clampHandler=new st,this.restrictionHandler=new lt,this.restrictionHandler.chainHandler(this.clampHandler).chainHandler(this.baseHandler),this.nextHandler=this.restrictionHandler}}class ct{constructor(t=void 0){this._nextHandler=t}set nextHandler(t){this._nextHandler=t}get nextHandler(){return this._nextHandler}chainHandler(t){return this._nextHandler=t,t}rotateCameraTo(t,e){this._nextHandler&&this._nextHandler.rotateCameraTo(t,e)}rotateCameraBy(t,e){this._nextHandler&&this._nextHandler.rotateCameraBy(t,e)}}class ut extends ct{constructor(t=void 0){super()}rotateCameraTo(t,e){e=rt(e),t.setRotation(e)}rotateCameraBy(t,e){const i=t.rotation,r=rt(i+e);e=nt(i,r),t.setRotation(r)}}class dt extends ct{constructor(t=void 0){super(t),this._restrictRotation=!1}get restrictRotation(){return this._restrictRotation}set restrictRotation(t){this._restrictRotation=t}rotateCameraBy(t,e){this._restrictRotation||super.rotateCameraBy(t,e)}rotateCameraTo(t,e){this._restrictRotation||super.rotateCameraTo(t,e)}}class mt extends ct{constructor(t=void 0){super(t)}rotateCameraBy(t,e){const i=t.rotation;let r=rt(i+e);r=it(r,t.rotationBoundaries),e=nt(i,r),super.rotateCameraBy(t,e)}rotateCameraTo(t,e){e=it(e=rt(e),t.rotationBoundaries),super.rotateCameraTo(t,e)}}class yt extends ct{get restrictRotation(){return this._restrictionHandler.restrictRotation}set restrictRotation(t){this._restrictionHandler.restrictRotation=t}constructor(t=void 0){super(t),this._baseHandler=new ut,this._clampHandler=new mt(this._baseHandler),this._restrictionHandler=new dt(this._clampHandler)}rotateCameraBy(t,e){this._restrictionHandler.rotateCameraBy(t,e),super.rotateCameraBy(t,e)}rotateCameraTo(t,e){this._restrictionHandler.rotateCameraTo(t,e),super.rotateCameraTo(t,e)}}class pt{constructor(t=void 0){this._nextHandler=t}set nextHandler(t){this._nextHandler=t}get nextHandler(){return this._nextHandler}chainHandler(t){return this._nextHandler=t,t}zoomCameraTo(t,e){this._nextHandler&&this._nextHandler.zoomCameraTo(t,e)}zoomCameraBy(t,e){this._nextHandler&&this._nextHandler.zoomCameraBy(t,e)}zoomCameraToAt(t,e,i){this._nextHandler&&this._nextHandler.zoomCameraToAt(t,e,i)}zoomCameraByAt(t,e,i){this._nextHandler&&this._nextHandler.zoomCameraByAt(t,e,i)}}class vt extends pt{constructor(t,e=void 0){super(e),this.panHandler=t}set nextHandler(t){this._nextHandler=void 0}zoomCameraTo(t,e){t.setZoomLevel(e)}zoomCameraBy(t,e){const i=t.zoomLevel+e;t.setZoomLevel(i)}zoomCameraToAt(t,e,i){let r=$(i,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);t.zoomLevel,t.setZoomLevel(e);let n=$(i,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);const a=j.subVector(r,n);this.panHandler.panCameraBy(t,a)}zoomCameraByAt(t,e,i){let r=$(i,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);const n=t.zoomLevel+e;t.setZoomLevel(n);let a=$(i,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);const o=j.subVector(r,a);this.panHandler.panCameraBy(t,o)}}class bt extends pt{constructor(t=void 0){super(t)}zoomCameraTo(t,e){e=N(e,t.zoomBoundaries),super.zoomCameraTo(t,e)}zoomCameraBy(t,e){let i=t.zoomLevel+e;i=N(i,t.zoomBoundaries),e=i-t.zoomLevel,super.zoomCameraBy(t,e)}zoomCameraToAt(t,e,i){e=N(e,t.zoomBoundaries),super.zoomCameraToAt(t,e,i)}zoomByAt(t,e,i){let r=t.zoomLevel+e;r=N(r,t.zoomBoundaries),e=r-t.zoomLevel,super.zoomCameraByAt(t,e,i)}}class xt extends pt{constructor(t=void 0){super(t),this._restrictZoom=!1}set restrictZoom(t){this._restrictZoom=t}get restrictZoom(){return this._restrictZoom}zoomCameraTo(t,e){this._restrictZoom||super.zoomCameraTo(t,e)}zoomCameraBy(t,e){this._restrictZoom||super.zoomCameraBy(t,e)}zoomCameraToAt(t,e,i){this._restrictZoom||super.zoomCameraToAt(t,e,i)}zoomCameraByAt(t,e,i){this._restrictZoom||super.zoomCameraByAt(t,e,i)}}class _t extends pt{constructor(t,e=void 0){super(e),this._baseHandler=new vt(t),this._clampHandler=new bt,this._restrictionHandler=new xt,this._restrictionHandler.chainHandler(this._clampHandler).chainHandler(this._baseHandler),this._nextHandler=this._restrictionHandler}set restrictZoom(t){this._restrictionHandler.restrictZoom=t}get restrictZoom(){return this._restrictionHandler.restrictZoom}zoomCameraTo(t,e){super.zoomCameraTo(t,e)}zoomCameraBy(t,e){super.zoomCameraBy(t,e)}zoomCameraByAt(t,e,i){super.zoomCameraByAt(t,e,i)}zoomCameraToAt(t,e,i){super.zoomCameraToAt(t,e,i)}}function gt(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}"function"==typeof SuppressedError&&SuppressedError,Object.freeze({__proto__:null,easeInBack:function(t){return 2.70158*t*t*t-1.70158*t*t},easeInBounce:function(t){return 1-gt(1-t)},easeInCirc:function(t){return 1-Math.sqrt(1-Math.pow(t,2))},easeInCubic:function(t){return t*t*t},easeInElastic:function(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*e)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*t-10)},easeInOutBack:function(t){const e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2},easeInOutBounce:function(t){return t<.5?(1-gt(1-2*t))/2:(1+gt(2*t-1))/2},easeInOutCirc:function(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2},easeInOutCubic:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2},easeInOutElastic:function(t){const e=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1},easeInOutExpo:function(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2},easeInOutQuad:function(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2},easeInOutSine:function(t){return-(Math.cos(Math.PI*t)-1)/2},easeInQuad:function(t){return t*t},easeInQuart:function(t){return t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeInSine:function(t){return 1-Math.cos(t*Math.PI/2)},easeOutBack:function(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)},easeOutBounce:gt,easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeOutCubic:function(t){return 1-Math.pow(1-t,3)},easeOutElastic:function(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},easeOutQuad:function(t){return 1-(1-t)*(1-t)},easeOutQuart:function(t){return 1-Math.pow(1-t,4)},easeOutQuint:function(t){return 1-Math.pow(1-t,5)},easeOutSine:function(t){return Math.sin(t*Math.PI/2)},linear:function(t){return t}});class zt{constructor(t){this._controlCenter=t}notifyPanByTransition(t,e){this._controlCenter.panController.panCameraBy(t,e)}notifyPanToTransition(t,e){this._controlCenter.panController.panCameraTo(t,e)}notifyPanInput(t,e){this._controlCenter.userTakeBackPanControl(),this._controlCenter.panController.panCameraBy(t,e)}notifyPanToOnTarget(t,e){}}class Ct{constructor(t){this._controlCenter=t}notifyPanByTransition(t,e){}notifyPanToTransition(t,e){}notifyPanInput(t,e){this._controlCenter.panController.panCameraBy(t,e)}notifyPanToOnTarget(t,e){}}class Tt{constructor(t){this._controlCenter=t}notifyZoomByAtTransition(t,e,i){}notifyZoomInput(t,e,i){this._controlCenter.zoomController.zoomCameraToAt(t,t.zoomLevel+e,i)}notifyZoomToAtOnTarget(t,e,i){}}let ft=document.getElementById("test-graph"),wt=new class{constructor(t){this._alignCoordinateSystem=!0,this._fullScreen=!1,this.lastUpdateTime=0,this._canvas=t,this.boardStateObserver=new A(new k),this.boardStateObserver.camera.viewPortHeight=t.height,this.boardStateObserver.camera.viewPortWidth=t.width,this.boardStateObserver.camera.boundaries={min:{x:-5e3,y:-5e3},max:{x:5e3,y:5e3}};let e=t.getContext("2d");if(null==e)throw new Error("Canvas 2d context is null");this._context=e;let i=new x,r=new S(i),n=new T;this.bindFunctions(),this.attributeObserver=new MutationObserver(this.attributeCallBack),this.attributeObserver.observe(this._canvas,{attributes:!0}),this.windowResizeObserver=new ResizeObserver(this.windowResizeHandler),this.windowResizeObserver.observe(document.body),this.boardInputObserver=new R(new E(i,r,n)),this._kmtStrategy=new O(this._canvas,this.boardStateObserver.camera,this.boardInputObserver),this.boardStateObserver.subscribeToCamera(this._kmtStrategy),this._touchStrategy=new V(this._canvas,this.boardStateObserver.camera,this.boardInputObserver),this.boardStateObserver.subscribeToCamera(this._touchStrategy),this.registerEventListeners()}registerEventListeners(){this._kmtStrategy.setUp(),this._touchStrategy.setUp()}removeEventListeners(){this._touchStrategy.tearDown(),this._kmtStrategy.tearDown()}setup(){this.registerEventListeners(),this.windowResizeObserver.observe(document.body),this.attributeObserver.observe(this._canvas,{attributes:!0})}tearDown(){this.removeEventListeners(),this.windowResizeObserver.disconnect(),this.attributeObserver.disconnect()}bindFunctions(){this.step=this.step.bind(this),this.attributeCallBack=this.attributeCallBack.bind(this),this.windowResizeHandler=this.windowResizeHandler.bind(this)}set width(t){if(this._canvas.width=t,this.boardStateObserver.camera.viewPortWidth=t,this.boardInputObserver.controlCenter.panController.limitEntireViewPort){const t=I(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);null!=t&&L(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}get width(){return this._canvas.width}set height(t){if(this._canvas.height=t,this.boardStateObserver.camera.viewPortHeight=t,this.boardInputObserver.controlCenter.panController.limitEntireViewPort){const t=D(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);null!=t&&L(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}get height(){return this._canvas.height}set alignCoordinateSystem(t){this._alignCoordinateSystem=t,this._kmtStrategy.alignCoordinateSystem=t,this._touchStrategy.alignCoordinateSystem=t}get alignCoordinateSystem(){return this._alignCoordinateSystem}get fullScreen(){return this._fullScreen}set fullScreen(t){this._fullScreen=t,this._fullScreen&&(this.width=window.innerWidth,this.height=window.innerHeight)}get context(){return this._context}set limitEntireViewPort(t){if(this.boardInputObserver.controlCenter.panController.limitEntireViewPort=t,t){const t=function(t,e,i,r){const n=s(t),a=l(t);if(null==n||null==a)return;let o=e/Math.abs(n*Math.cos(r)),h=e/Math.abs(a*Math.cos(r)),c=i/Math.abs(n*Math.sin(r)),u=i/Math.abs(a*Math.sin(r));o==1/0&&(o=0),h==1/0&&(h=0),c==1/0&&(c=0),u==1/0&&(u=0);const d=i/a,m=e/n;return Math.max(d,m,o,h,c,u)}(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);null!=t&&L(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}get limitEntireViewPort(){return this.boardInputObserver.controlCenter.panController.limitEntireViewPort}set kmtStrategy(t){this._kmtStrategy.tearDown(),this.boardStateObserver.unsubscribeToCamera(this._kmtStrategy),t.setUp(),this._kmtStrategy=t,this.boardStateObserver.subscribeToCamera(this._kmtStrategy),this._kmtStrategy.camera=this.boardStateObserver.camera}get kmtStrategy(){return this._kmtStrategy}set touchStrategy(t){this._touchStrategy.tearDown(),this.boardStateObserver.unsubscribeToCamera(this._touchStrategy),t.setUp(),this._touchStrategy=t,this.boardStateObserver.subscribeToCamera(this._touchStrategy),this._touchStrategy.camera=this.boardStateObserver.camera}get touchStrategy(){return this._touchStrategy}get camera(){return this.boardStateObserver.camera}set camera(t){t.viewPortHeight=this._canvas.height,t.viewPortWidth=this._canvas.width,this.boardStateObserver.camera=t}set panHandler(t){this.boardInputObserver.controlCenter.panController=t}get panHandler(){return this.boardInputObserver.controlCenter.panController}set zoomHandler(t){this.boardStateObserver.zoomHandler=t}get zoomHandler(){return this.boardStateObserver.zoomHandler}set controlCenter(t){let e=this.boardInputObserver.controlCenter.panController,i=this.boardInputObserver.controlCenter.zoomController,r=this.boardInputObserver.controlCenter.rotationController;t.panController=e,t.zoomController=i,t.rotationController=r,this.boardInputObserver.controlCenter=t}get controlCenter(){return this.boardInputObserver.controlCenter}step(t){this.lastUpdateTime,this.lastUpdateTime=t,this._context.reset();const e=this.boardStateObserver.camera.boundaries;if(null==(i=e)||null==i.max||null==i.min||null==i.max.x||null==i.max.y||null==i.min.x||null==i.min.y)throw new Error("Boundaries are not fully defined; not able to clear the canvas under the current implementation");var i;this._context.clearRect(e.min.x,-e.min.y,e.max.x-e.min.x,-(e.max.y-e.min.y)),this._context.translate(this._canvas.width/2,this._canvas.height/2),this._context.scale(this.boardStateObserver.camera.zoomLevel,this.boardStateObserver.camera.zoomLevel),this._alignCoordinateSystem?(this._context.rotate(-this.boardStateObserver.camera.rotation),this._context.translate(-this.boardStateObserver.camera.position.x,-this.boardStateObserver.camera.position.y)):(this._context.rotate(this.boardStateObserver.camera.rotation),this._context.translate(-this.boardStateObserver.camera.position.x,this.boardStateObserver.camera.position.y))}convertWindowPoint2ViewPortPoint(t,e){const r=i.subVector(e,t);return this._alignCoordinateSystem?{x:r.x,y:r.y}:{x:r.x,y:-r.y}}convertWindowPoint2WorldCoord(t){if(this._alignCoordinateSystem){const e=this.convertWindowPoint2ViewPortPoint({y:this._canvas.getBoundingClientRect().top,x:this._canvas.getBoundingClientRect().left},t);return this.boardStateObserver.camera.convertFromViewPort2WorldSpace(e)}{const e=this.convertWindowPoint2ViewPortPoint({y:this._canvas.getBoundingClientRect().bottom,x:this._canvas.getBoundingClientRect().left},t);return this.boardStateObserver.camera.convertFromViewPort2WorldSpace(e)}}on(t,e){return this.boardStateObserver.camera.on(t,e)}onInput(t,e){return this.boardInputObserver.onInput(t,e)}get maxHalfTransHeight(){return function(t){const e=l(t);return null!=e?e/2:void 0}(this.boardStateObserver.camera.boundaries)}get maxHalfTransWidth(){return function(t){const e=s(t);return null!=e?e/2:void 0}(this.boardStateObserver.camera.boundaries)}attributeCallBack(t,e){for(let e of t)if("attributes"===e.type)if("width"===e.attributeName){if(this.boardStateObserver.camera.viewPortWidth=this._canvas.width,this.limitEntireViewPort){const t=I(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);L(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}else if("height"===e.attributeName&&(this.boardStateObserver.camera.viewPortHeight=this._canvas.height,this.limitEntireViewPort)){const t=D(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);L(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}windowResizeHandler(){this._fullScreen&&(this.width=window.innerWidth,this.height=window.innerHeight)}setMaxTransWidthAlignedMin(t){const e=this.boardStateObserver.camera.boundaries,i=null==e?void 0:e.min,r=null==i?void 0:i.x;if(null==r?this.boardStateObserver.camera.setHorizontalBoundaries(-t,t):this.boardStateObserver.camera.setHorizontalBoundaries(r,r+2*t),this.limitEntireViewPort){const t=I(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);L(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}}(ft);wt.limitEntireViewPort=!0,wt.panHandler.restrictTranslation=!0;const Ht=new class{constructor(t=new ht,e=new _t(t),i=new yt){this._panController=t,this._zoomController=e,this._rotationController=i,this._panState=new Ct(this),this._zoomState=new Tt(this)}notifyPanInput(t,e){this._panState.notifyPanInput(t,e)}notifyZoomInput(t,e,i){this._zoomState.notifyZoomInput(t,e,i)}notifyRotationInput(t,e){}notifyPanByTransition(t,e){}notifyPanToTransition(t,e){this._panState.notifyPanToTransition(t,e)}notifyZoomByAtTransition(t,e,i){this._zoomState.notifyZoomByAtTransition(t,e,i)}notifyRotationByTransition(t,e){}initiatePanTransitioinInput(){this._panState=new zt(this)}userTakeBackPanControl(){this._panState=new Ct(this)}userTakeBackZoomControl(){this._zoomState=new Tt(this)}get panController(){return this._panController}get zoomController(){return this._zoomController}get rotationController(){return this._rotationController}set panController(t){this._panController=t}set zoomController(t){this._zoomController=t}set rotationController(t){this._rotationController=t}};wt.controlCenter=Ht;let Pt=0;const St=new K([{percentage:0,value:0},{percentage:1,value:100}],(t=>{Pt=t}),new q),Mt=new K([{percentage:0,value:{x:0,y:0}},{percentage:1,value:{x:100,y:100}}],(t=>{Ht.notifyPanToTransition(wt.camera,t)}),new class{constructor(){}lerp(t,e,i){const r=(t-e.percentage)/(i.percentage-e.percentage);let n=r;return e.easingFn&&(n=e.easingFn(r)),U.addVector(e.value,U.multiplyVectorByScalar(U.subVector(i.value,e.value),n))}});Mt.easeFunction=function(t){return Math.sin(t*Math.PI/2)},St.easeFunction=function(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2};const Bt=new G;Bt.addAnimation("extend stick",St,0),wt.camera.setRotation(45*Math.PI/180);const kt=[{percentage:0,value:-Math.PI/2,easingFn:Q},{percentage:.5,value:3*Math.PI/2,easingFn:Q}];let Ot=-Math.PI/2;const Vt=new K(kt,(t=>{Ot=t}),new q);Vt.onStart((()=>{console.log("swing stick animation started playing but may have delay")})),Vt.onStartAfterDelay((()=>{console.log("swing stick animation started playing after delay")})),Vt.delay=0,Vt.drag=1e3,console.log("swing stick delay",Vt.delay),console.log("swing stick drag",Vt.drag),console.log("swing stick duration",Vt.duration),console.log("swing stick true duration",Vt.trueDuration),Vt.onEnd((()=>{console.log("swing stick animation completed")})),St.duration=300,Bt.addAnimationAfter("swing stick",Vt,"extend stick"),Bt.onEnd((()=>{console.log("opening animation completed"),wt.panHandler.restrictTranslation=!1})),console.log("duration of opening animation",Bt.duration);const Lt=new G;Lt.onEnd((()=>{console.log("composite animation completed")})),Lt.duration=1e3;const It={x:0,y:0};ft.addEventListener("pointermove",(t=>{It.x=t.clientX-ft.getBoundingClientRect().left,It.y=t.clientY-ft.getBoundingClientRect().top})),ft.addEventListener("pointerdown",(t=>{const e=wt.convertWindowPoint2WorldCoord({x:t.clientX,y:t.clientY});console.log("clicked point",e);const i=[{percentage:0,value:Object.assign({},wt.camera.position)},{percentage:1,value:e}];Ht.initiatePanTransitioinInput(),Mt.keyFrames=i,Lt.startAnimation(),Bt.startAnimation()}));let Dt=0;!function t(e){wt.step(e);const i=e-Dt;Dt=e,function(t,e,i,r){if(!Y(e))return;const n=Z(e),a=W(e),o=null==e?void 0:e.min,s=null==o?void 0:o.x,l=null==o?void 0:o.y;null!=s&&null!=l&&null!=n&&null!=a&&(t.lineWidth=1/i,t.beginPath(),t.strokeStyle="rgba(87, 173, 72, 0.8)",t.moveTo(0,0),r?t.lineTo(0,l+a):t.lineTo(0,-l-a),t.stroke(),t.beginPath(),t.strokeStyle="rgba(220, 59, 59, 0.8)",t.moveTo(0,0),t.lineTo(s+n,0),t.stroke(),t.strokeStyle="black")}(wt.context,wt.camera.boundaries,wt.camera.zoomLevel,wt.alignCoordinateSystem);const r=ft.getBoundingClientRect();wt.convertWindowPoint2WorldCoord({x:r.left,y:r.top}),wt.convertWindowPoint2WorldCoord({x:r.right,y:r.top}),wt.convertWindowPoint2WorldCoord({x:r.left,y:r.bottom}),wt.convertWindowPoint2WorldCoord({x:r.right,y:r.bottom}),function(t,e,i){if(!Y(e))return;const r=Z(e),n=W(e),a=null==e?void 0:e.min,o=null==a?void 0:a.x,s=null==a?void 0:a.y;null!=o&&null!=s&&null!=r&&null!=n&&(t.beginPath(),t.strokeStyle="blue",t.lineWidth=100,t.roundRect(o,-s,r,-n,5),t.stroke(),t.lineWidth=3,t.strokeStyle="black")}(wt.context,wt.camera.boundaries),wt.context.beginPath(),wt.context.moveTo(0,0);const n={x:Pt*Math.cos(Ot),y:Pt*Math.sin(Ot)};wt.context.lineTo(n.x,n.y),wt.context.stroke(),Lt.animate(i),Bt.animate(i),window.requestAnimationFrame(t)}(0);const At=new Worker("webworkerA.js");At.postMessage("Hello from main script");const Rt=new Worker("webworkerB.js"),Et=new MessageChannel;At.postMessage({port:Et.port1},[Et.port1]),Rt.postMessage({port:Et.port2},[Et.port2]),document.addEventListener("visibilitychange",(function(){document.hidden?console.log("Browser tab is hidden"):(console.log("Browser tab is visible"),Dt=Date.now())}))})();
//# sourceMappingURL=index.js.map