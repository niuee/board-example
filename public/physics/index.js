(()=>{"use strict";class t{static addVector(t,e){return null==t.z&&null==e.z?{x:t.x+e.x,y:t.y+e.y}:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z})}static subVector(t,e){return null==t.z&&null==e.z?{x:t.x-e.x,y:t.y-e.y}:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z})}static multiplyVectorByScalar(t,e){return null==t.z?{x:t.x*e,y:t.y*e}:{x:t.x*e,y:t.y*e,z:t.z*e}}static divideVectorByScalar(t,e){return 0==e?{x:t.x,y:t.y}:null==t.z?{x:t.x/e,y:t.y/e}:{x:t.x/e,y:t.y/e,z:t.z/e}}static magnitude(t){return null==t.z&&(t.z=0),Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static unitVector(t){return null==t.z&&(t.z=0),0!=this.magnitude(t)?{x:t.x/this.magnitude(t),y:t.y/this.magnitude(t),z:t.z/this.magnitude(t)}:{x:0,y:0,z:0}}static dotProduct(t,e){return null==t.z&&null==e.z?t.x*e.x+t.y*e.y:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),t.x*e.x+t.y*e.y+t.z*e.z)}static crossProduct(t,e){return null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}static unitVectorFromA2B(t,e){return this.unitVector(this.subVector(e,t))}static rotatePoint(t,e){return{x:t.x*Math.cos(e)-t.y*Math.sin(e),y:t.x*Math.sin(e)+t.y*Math.cos(e)}}static transform2NewAxis(t,e){return{x:t.x*Math.cos(e)+t.y*Math.sin(e),y:-t.x*Math.sin(e)+t.y*Math.cos(e)}}static angleFromA2B(t,e){return Math.atan2(t.x*e.y-t.y*e.x,t.x*e.x+t.y*e.y)}static transformPointWRTAnchor(t,e,i){let r=this.rotatePoint(this.subVector(t,e),i);return this.addVector(r,e)}static distanceBetweenPoints(t,e){return this.magnitude(this.subVector(t,e))}static flipYAxis(t){return{x:t.x,y:-t.y,z:t.z}}static linearInterpolation(t,e,i){return null==t.z||null==e.z?{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}:{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i,z:t.z+(e.z-t.z)*i}}static isEqual(t,e){return null==t.z&&(t.z=0),null==e.z&&(e.z=0),t.x==e.x&&t.y==e.y&&t.z==e.z}static getLineIntersection(e,i,r,n){const o=(n.x-r.x)*(e.y-r.y)-(n.y-r.y)*(e.x-r.x),s=(n.y-r.y)*(i.x-e.x)-(n.x-r.x)*(i.y-e.y);if(0===s)return{intersects:!1};const a=o/s;return a>=0&&a<=1?{intersects:!0,intersection:t.linearInterpolation(e,i,a),offset:a}:{intersects:!1}}}function e(e,i,r){if(!r)return[];const n=[];return i.forEach((e=>{let i=e.bodyA,o=e.bodyB;if(i==o)return;let s=null==i.center.z?0:i.center.z,a=null==o.center.z?0:o.center.z;if(Math.abs(s-a)>.5)return;let{collision:l,depth:c,normal:h}=function(e,i){let r=[],n=e.getCollisionAxes(i),o=i.getCollisionAxes(e);r.push(...n),r.push(...o);let s=!0,a=Number.MAX_VALUE,l=r[0];return r.forEach((r=>{let n=e.getMinMaxProjection(r),o=i.getMinMaxProjection(r);if(n.min>=o.max||o.min>=n.max)s=!1;else{let e=Math.abs(Math.min(n.max,o.max)-Math.max(o.min,n.min));e<a&&(a=e,l=r,n.max<o.max&&(l=t.multiplyVectorByScalar(l,-1)))}})),s?{collision:s,depth:a,normal:l}:{collision:!1,depth:void 0,normal:void 0}}(i,o);if(l&&void 0!==h&&void 0!==c){let e=t.multiplyVectorByScalar(h,c/2),s=t.multiplyVectorByScalar(h,-c/2);i.isStatic()||i.move(e),o.isStatic()||o.move(s),i.isStatic()&&o.move(s),o.isStatic()&&i.move(e);const a=i.getNormalOfSignificantFace(t.multiplyVectorByScalar(h,-1)),l=o.getNormalOfSignificantFace(h),u=i.getSignificantVertices(t.multiplyVectorByScalar(h,-1)),d=o.getSignificantVertices(h),m=Math.abs(t.dotProduct(a,t.multiplyVectorByScalar(h,-1))),y=Math.abs(t.dotProduct(l,h));if(1==d.length||1==u.length)1==d.length?n.push(d[0]):n.push(u[0]);else if(m>y){const e=i.getAdjacentFaces(t.multiplyVectorByScalar(h,-1));let r=[...d];for(let i=0;i<e.length-1;i++){let n=e[i].startPoint.coord,o=e[i].endPoint.coord,s=t.subVector(o,n),a=t.subVector(r[0],n),l=t.subVector(r[1],n),c=t.angleFromA2B(s,a)>=0;if((c?1:0)^(t.angleFromA2B(s,l)>=0?1:0)){let e=t.getLineIntersection(n,o,r[0],r[1]);e.intersects&&void 0!==e.intersection&&(c?r[1]=e.intersection:r[0]=e.intersection)}}const o=e[e.length-1];let s=o.startPoint.coord,a=o.endPoint.coord,l=t.subVector(a,s),c=t.subVector(r[0],s),u=t.subVector(r[1],s),m=t.angleFromA2B(l,c)>=0,y=t.angleFromA2B(l,u)>=0;m&&n.push(r[0]),y&&n.push(r[1])}else{const e=o.getAdjacentFaces(h);let i=[...u];0==i.length&&console.log("warning");for(let r=0;r<e.length-1;r++){let n=e[r].startPoint.coord,o=e[r].endPoint.coord,s=t.subVector(o,n),a=t.subVector(i[0],n),l=t.subVector(i[1],n),c=t.angleFromA2B(s,a)>=0;if((c?1:0)^(t.angleFromA2B(s,l)>=0?1:0)){let e=t.getLineIntersection(n,o,i[0],i[1]);e.intersects&&void 0!==e.intersection&&(c?i[1]=e.intersection:i[0]=e.intersection)}}const r=e[e.length-1];let s=r.startPoint.coord,a=r.endPoint.coord,l=t.subVector(a,s),c=t.subVector(i[0],s),d=t.subVector(i[1],s),m=t.angleFromA2B(l,c)>=0,y=t.angleFromA2B(l,d)>=0;m&&n.push(i[0]),y&&n.push(i[1])}r&&function(e,i,r){if(e.isStatic()&&i.isStatic())return;let n=e.isStatic()||e.isMovingStatic()?0:1/e.mass,o=i.isStatic()||i.isMovingStatic()?0:1/i.mass,s=e.isStatic()||e.isMovingStatic()?0:1/e.momentOfInertia,a=i.isStatic()||i.isMovingStatic()?0:1/i.momentOfInertia;const l=[];for(let c=0;c<r.contactPoints.length;c++){const h=r.contactPoints[c],u=t.subVector(h,e.center),d=t.subVector(h,i.center),m={x:-u.y,y:u.x},y={x:-d.y,y:d.x},g=t.multiplyVectorByScalar(m,e.angularVelocity),b=t.multiplyVectorByScalar(y,i.angularVelocity);let x=t.subVector(t.addVector(e.linearVelocity,g),t.addVector(i.linearVelocity,b)),v=t.dotProduct(x,r.normal);const p=t.dotProduct(m,r.normal),_=t.dotProduct(y,r.normal);let f=-1.4*v;f/=n+o+p*p*s+_*_*a,f/=r.contactPoints.length,l.push(t.multiplyVectorByScalar(r.normal,f))}l.forEach(((l,c)=>{let h=t.multiplyVectorByScalar(l,n),u=t.multiplyVectorByScalar(l,o);e.linearVelocity=t.addVector(e.linearVelocity,h);let d=t.crossProduct(t.subVector(r.contactPoints[c],e.center),l).z;d=null==d?0:d;let m=t.crossProduct(t.subVector(r.contactPoints[c],i.center),l).z;m=null==m?0:m,e.angularVelocity+=d*s,i.angularVelocity-=m*a,i.linearVelocity=t.subVector(i.linearVelocity,u)}))}(i,o,{normal:h,contactPoints:n})}})),n}class i{constructor(t,e,i){this.bottomLeft=t,this.width=e,this.height=i}getWidth(){return this.width}getHeight(){return this.height}getbottomLeft(){return this.bottomLeft}}class r{constructor(t,e){this.MAX_OBJECTS=10,this.MAX_LEVELS=5,this.objects=[],this.nodes=[],this.level=t,this.objects=[],this.bounds=e,this.nodes=[void 0,void 0,void 0,void 0]}draw(t){t.beginPath(),t.rect(this.bounds.getbottomLeft().x,this.bounds.getbottomLeft().y,this.bounds.getWidth(),this.bounds.getHeight()),t.stroke();for(let e=0;e<this.nodes.length;e++){let i=this.nodes[e];null!=i&&i.draw(t)}}clear(){this.objects=[];for(let t=0;t<this.nodes.length;t++){let e=this.nodes[t];null!=e&&(e.clear(),e=void 0)}}split(){let t=this.bounds.getWidth()/2,e=this.bounds.getHeight()/2,n=this.bounds.getbottomLeft();this.nodes[0]=new r(this.level+1,new i({x:n.x,y:n.y},t,e)),this.nodes[1]=new r(this.level+1,new i({x:n.x,y:n.y+e},t,e)),this.nodes[2]=new r(this.level+1,new i({x:n.x+t,y:n.y+e},t,e)),this.nodes[3]=new r(this.level+1,new i({x:n.x+t,y:n.y},t,e))}getIndex(t){let e=this.bounds.getbottomLeft().x+this.bounds.getWidth()/2,i=this.bounds.getbottomLeft().y+this.bounds.getHeight()/2,r=t.AABB,n=r.max.y<i&&r.min.y>this.bounds.getbottomLeft().y,o=r.max.x<e&&r.min.x>this.bounds.getbottomLeft().x,s=r.max.x>e&&r.min.x>e,a=r.max.y>i&&r.min.y>i;return n&&o?0:n&&s?3:a&&o?1:a&&s?2:-1}insert(t){let e=this.nodes[0];if(null!=e){let i=this.getIndex(t);if(-1!==i)return e=this.nodes[i],void(null==e||e.insert(t))}if(this.objects.push(t),this.objects.length>this.MAX_OBJECTS&&this.level<this.MAX_LEVELS){null!=this.nodes[0]&&null!=this.nodes[0]||this.split();let t=0;for(;t<this.objects.length;){let e=this.getIndex(this.objects[t]),i=this.nodes[e];if(-1!=e&&void 0!==i){let e=this.objects[t];this.objects.splice(t,1),i.insert(e)}else t++}}}retrieve(t){let e=this.getIndex(t),i=[],r=this.nodes[e];return-1!==e&&void 0!==r&&i.push(...r.retrieve(t)),i.push(...this.objects),i}}class n{constructor(t,e=0,i=50,r=!1,n=!1){this._mass=50,this._orientationAngle=0,this.isStaticBody=!1,this._staticFrictionCoeff=.3,this.dynamicFrictionCoeff=.3,this.frictionEnabled=!1,this.isMovingStaticBody=!1,this.angularDampingFactor=.005,this._center=t,this._orientationAngle=e,this._mass=i,this.isStaticBody=r,this.frictionEnabled=n,this.force={x:0,y:0},this.linearAcceleartion={x:0,y:0},this._linearVelocity={x:0,y:0},this._angularVelocity=0}move(e){this.isStatic()||(this._center=t.addVector(this._center,e))}rotateRadians(t){this._orientationAngle+=t}getCenter(){return this._center}getOrientationAngle(){return this._orientationAngle}get angularVelocity(){return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t}get orientationAngle(){return this._orientationAngle}isStatic(){return this.isStaticBody}isMovingStatic(){return this.isMovingStaticBody}setLinearVelocity(t){this._linearVelocity=t}setMovingStatic(t){this.isMovingStaticBody=t}setOrientationAngle(t){this._orientationAngle=t}applyForce(e){0!==t.magnitude(this.force)?this.force=t.addVector(this.force,e):this.force=e}applyForceInOrientation(e){let i;i="number"==typeof e?t.rotatePoint({x:e,y:0},this._orientationAngle):t.rotatePoint(e,this._orientationAngle),this.applyForce(i)}step(e){if(this.frictionEnabled)if(this.isStatic()||0==this.linearVelocity.x&&0==this.linearVelocity.y&&t.magnitude(t.subVector({x:this.force.x,y:this.force.y},{x:0,y:0}))>=0&&t.magnitude({x:this.force.x,y:this.force.y})<this.staticFrictionCoeff*this.mass*9.81)null!=this.force.z?this.force={x:0,y:0,z:this.force.z}:this.force={x:0,y:0};else{let e=t.multiplyVectorByScalar(t.unitVector({x:this._linearVelocity.x,y:this._linearVelocity.y}),-1),i=t.multiplyVectorByScalar(e,this.dynamicFrictionCoeff*this.mass*9.81);this.force=t.addVector(this.force,i)}const i=0!=this._angularVelocity?this._angularVelocity>0?-this.angularDampingFactor:this.angularDampingFactor:0;Math.abs(this._angularVelocity)<Math.abs(i)?this._angularVelocity=0:this._angularVelocity+=i,this._orientationAngle+=this._angularVelocity*e,t.magnitude({x:this._linearVelocity.x,y:this._linearVelocity.y})<t.magnitude(t.divideVectorByScalar(t.multiplyVectorByScalar(this.force,e),this.mass))&&(null!=this._linearVelocity.z?this._linearVelocity={x:0,y:0,z:this._linearVelocity.z}:this._linearVelocity={x:0,y:0});const r=-9.81*this._mass;this.force=t.addVector(this.force,{x:0,y:0,z:r}),this._linearVelocity=t.addVector(this._linearVelocity,t.divideVectorByScalar(t.multiplyVectorByScalar(this.force,e),this.mass)),this._center=t.addVector(this._center,t.multiplyVectorByScalar(this._linearVelocity,e)),null!=this._center.z&&this._center.z<0&&(this._center.z=0),this.force={x:0,y:0}}get center(){return this._center}set center(t){this._center=t}get linearVelocity(){return this._linearVelocity}set linearVelocity(t){this._linearVelocity=t}get mass(){return this._mass}get staticFrictionCoeff(){return this._staticFrictionCoeff}set staticFrictionCoeff(t){this._staticFrictionCoeff=t}}class o{constructor(t={x:0,y:0},e,i,r=0,n=50,o=!1,a=!0){this._polygon=new s(t,e,r,n,o,a),this._context=i}draw(t){t.beginPath();let e=this._polygon.getVerticesAbsCoord();t.moveTo(e[0].x,e[0].y),e.forEach((e=>{t.lineTo(e.x,e.y)})),t.lineTo(e[0].x,e[0].y),t.stroke()}step(t){this._polygon.step(t),this.draw(this._context)}isStatic(){return this._polygon.isStatic()}isMovingStatic(){return this._polygon.isMovingStatic()}getMinMaxProjection(t){return this._polygon.getMinMaxProjection(t)}getCollisionAxes(t){return this._polygon.getCollisionAxes(t)}applyForce(t){this._polygon.applyForce(t)}applyForceInOrientation(t){this._polygon.applyForceInOrientation(t)}setLinearVelocity(t){this._polygon.setLinearVelocity(t)}move(t){this._polygon.move(t)}get center(){return this._polygon.center}set center(t){this._polygon.center=t}get linearVelocity(){return this._polygon.linearVelocity}set linearVelocity(t){this._polygon.linearVelocity=t}get angularVelocity(){return this._polygon.angularVelocity}set angularVelocity(t){this._polygon.angularVelocity=t}get orientationAngle(){return this._polygon.orientationAngle}significantVertex(t){return this._polygon.significantVertex(t)}getSignificantVertices(t){return this._polygon.getSignificantVertices(t)}get AABB(){return this._polygon.AABB}get mass(){return this._polygon.mass}get staticFrictionCoeff(){return this._polygon.staticFrictionCoeff}set staticFrictionCoeff(t){this._polygon.staticFrictionCoeff=t}get momentOfInertia(){return this._polygon.momentOfInertia}getNormalOfSignificantFace(t){return this._polygon.getNormalOfSignificantFace(t)}getAdjacentFaces(t){return this._polygon.getAdjacentFaces(t)}}class s extends n{constructor(e={x:0,y:0},i,r=0,n=50,o=!1,s=!0){super(e,r,n,o,s),this.vertices=i,this.step=this.step.bind(this);let a=this.vertices.reduce(((e,i,r)=>{let n=r<this.vertices.length-1?r+1:0,o=this.vertices[n],s=t.crossProduct(o,i);return e+t.magnitude(s)*(t.dotProduct(i,i)+t.dotProduct(i,o)+t.dotProduct(o,o))}),0),l=this.vertices.reduce(((e,i,r)=>e+t.magnitude(t.crossProduct(this.vertices[r<this.vertices.length-1?r+1:0],i))),0);this._momentOfInertia=this._mass*a/(6*l)}getVerticesAbsCoord(){return this.vertices.map((e=>t.addVector(this._center,t.rotatePoint(e,this._orientationAngle))))}getCollisionAxes(e){return this.getVerticesAbsCoord().map(((e,i,r)=>{let n=t.subVector(e,r[r.length-1]);return i>0&&(n=t.subVector(e,r[i-1])),t.unitVector(t.rotatePoint(n,Math.PI/2))}))}getMinMaxProjection(e){let i=this.getVerticesAbsCoord().map((i=>t.dotProduct(i,e)));return{min:Math.min(...i),max:Math.max(...i)}}get AABB(){let t=this.getVerticesAbsCoord(),e=t.map((t=>t.x)),i=t.map((t=>t.y));return{min:{x:Math.min(...e),y:Math.min(...i)},max:{x:Math.max(...e),y:Math.max(...i)}}}significantVertex(e){let i=this.getVerticesAbsCoord(),r=i.map((i=>t.dotProduct(i,e)));return i[r.indexOf(Math.max(...r))]}getSignificantVertices(e){let i=this.getVerticesAbsCoord(),r=i.map((i=>t.dotProduct(i,e))),n=r.indexOf(Math.max(...r));const o=i[n];let s=n>0?n-1:i.length-1,a=n<i.length-1?n+1:0;const l=i[s],c=i[a];return t.dotProduct(l,e)>t.dotProduct(c,e)?[l,o]:[o,c]}getNormalOfSignificantFace(e){const i=this.getSignificantVertices(e),r=t.unitVectorFromA2B(i[0],i[1]);return t.rotatePoint(r,-Math.PI/2)}getAdjacentFaces(e){let i=this.getVerticesAbsCoord(),r=i.map((i=>t.dotProduct(i,e))),n=r.indexOf(Math.max(...r));const o=i[n];let s=n>0?n-1:i.length-1,a=n<i.length-1?n+1:0;const l=i[s],c=i[a],h=[];if(t.dotProduct(l,e)>t.dotProduct(c,e)){h.push({startPoint:{coord:l,index:s},endPoint:{coord:o,index:n}}),h.unshift({startPoint:{coord:o,index:n},endPoint:{coord:c,index:a}});let t=s>0?s-1:i.length-1;h.unshift({startPoint:{coord:i[t],index:t},endPoint:{coord:l,index:s}})}else{h.push({startPoint:{coord:o,index:n},endPoint:{coord:c,index:a}});let t=a<i.length-1?a+1:0;h.unshift({startPoint:{coord:c,index:a},endPoint:{coord:i[t],index:t}}),h.unshift({startPoint:{coord:l,index:s},endPoint:{coord:o,index:n}})}return h}get momentOfInertia(){return this._momentOfInertia}}class a{constructor(t,e,i){this.bodyA=t,this.anchorA=e,this.worldAnchorA=i}enforce(t){this.solveWorldPinJointConstraint(t)}solveWorldPinJointConstraint(e){const i=this.bodyA,r=this.anchorA,n=this.worldAnchorA,o=t.addVector(i.center,t.rotatePoint(r,i.orientationAngle)),s=t.subVector(o,n),a=t.subVector(o,i.center),l=t.addVector(i.linearVelocity,t.crossProduct({x:0,y:0,z:i.angularVelocity},a)),c=i.isStatic()?0:1/i.mass,h=i.isStatic()?0:1/i.momentOfInertia,u=c+h*a.y*a.y,d=c+h*a.x*a.x,m=-h*a.x*a.y,y=-u*s.x-m*s.y-1*s.x/e-l.x,g=-m*s.x-d*s.y-1*s.y/e-l.y;i.isStatic()||(i.linearVelocity.x+=c*y,i.linearVelocity.y+=c*g,i.angularVelocity+=h*(a.x*g-a.y*y))}}class l{constructor(t,e,i,r){this.bodyA=t,this.bodyB=e,this.anchorA=i,this.anchorB=r}enforce(t){this.solvePinJointConstraint(t)}solvePinJointConstraint(e){const i=this.bodyA,r=this.bodyB,n=this.anchorA,o=this.anchorB,s=t.addVector(i.center,t.rotatePoint(n,i.orientationAngle)),a=t.addVector(r.center,t.rotatePoint(o,r.orientationAngle)),l=t.subVector(a,s),c=t.subVector(s,i.center),h=t.subVector(a,r.center),u=t.subVector(t.addVector(r.linearVelocity,t.crossProduct({x:0,y:0,z:r.angularVelocity},h)),t.addVector(i.linearVelocity,t.crossProduct({x:0,y:0,z:i.angularVelocity},c))),d=i.isStatic()?0:1/i.mass,m=r.isStatic()?0:1/r.mass,y=i.isStatic()?0:1/i.momentOfInertia,g=r.isStatic()?0:1/r.momentOfInertia,b=d+m+y*c.y*c.y+g*h.y*h.y,x=d+m+y*c.x*c.x+g*h.x*h.x,v=-y*c.x*c.y-g*h.x*h.y,p=-b*l.x-v*l.y-1*l.x/e-u.x,_=-v*l.x-x*l.y-1*l.y/e-u.y;i.isStatic()||(i.linearVelocity.x-=d*p,i.linearVelocity.y-=d*_,i.angularVelocity-=y*(c.x*_-c.y*p)),r.isStatic()||(r.linearVelocity.x+=m*p,r.linearVelocity.y+=m*_,r.angularVelocity+=g*(h.x*_-h.y*p))}}function c(t,e){return h(t,e)||void 0===e||(e.max&&(t=Math.min(e.max,t)),e.min&&(t=Math.max(e.min,t))),t}function h(t,e){return void 0===e||!(t<=0||void 0!==e&&(void 0!==e.max&&e.max<t||void 0!==e.min&&e.min>t))}class u{static addVector(t,e){return null==t.z&&null==e.z?{x:t.x+e.x,y:t.y+e.y}:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z})}static subVector(t,e){return null==t.z&&null==e.z?{x:t.x-e.x,y:t.y-e.y}:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z})}static multiplyVectorByScalar(t,e){return null==t.z?{x:t.x*e,y:t.y*e}:{x:t.x*e,y:t.y*e,z:t.z*e}}static divideVectorByScalar(t,e){return 0==e?{x:t.x,y:t.y}:null==t.z?{x:t.x/e,y:t.y/e}:{x:t.x/e,y:t.y/e,z:t.z/e}}static magnitude(t){return null==t.z&&(t.z=0),Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static unitVector(t){return null==t.z&&(t.z=0),0!=this.magnitude(t)?{x:t.x/this.magnitude(t),y:t.y/this.magnitude(t),z:t.z/this.magnitude(t)}:{x:0,y:0,z:0}}static dotProduct(t,e){return null==t.z&&null==e.z?t.x*e.x+t.y*e.y:(null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),t.x*e.x+t.y*e.y+t.z*e.z)}static crossProduct(t,e){return null!=t.z&&null!=e.z||(null==t.z&&(t.z=0),null==e.z&&(e.z=0)),{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}static unitVectorFromA2B(t,e){return this.unitVector(this.subVector(e,t))}static rotatePoint(t,e){return{x:t.x*Math.cos(e)-t.y*Math.sin(e),y:t.x*Math.sin(e)+t.y*Math.cos(e)}}static transform2NewAxis(t,e){return{x:t.x*Math.cos(e)+t.y*Math.sin(e),y:-t.x*Math.sin(e)+t.y*Math.cos(e)}}static angleFromA2B(t,e){return Math.atan2(t.x*e.y-t.y*e.x,t.x*e.x+t.y*e.y)}static transformPointWRTAnchor(t,e,i){let r=this.rotatePoint(this.subVector(t,e),i);return this.addVector(r,e)}static distanceBetweenPoints(t,e){return this.magnitude(this.subVector(t,e))}static flipYAxis(t){return{x:t.x,y:-t.y,z:t.z}}static linearInterpolation(t,e,i){return null==t.z||null==e.z?{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}:{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i,z:t.z+(e.z-t.z)*i}}static isEqual(t,e){return null==t.z&&(t.z=0),null==e.z&&(e.z=0),t.x==e.x&&t.y==e.y&&t.z==e.z}static getLineIntersection(t,e,i,r){const n=(r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x),o=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(0===o)return{intersects:!1};const s=n/o;return s>=0&&s<=1?{intersects:!0,intersection:u.linearInterpolation(t,e,s),offset:s}:{intersects:!1}}}function d(t,e,i,r,n,o){let s={x:i/2,y:r/2},a=u.subVector(e,s);return a=u.multiplyVectorByScalar(a,1/n),a=u.rotatePoint(a,o),u.addVector(t,a)}function m(t,e,i,r,n,o){let s={x:e/2,y:i/2},a=u.subVector(t,s);return a=u.multiplyVectorByScalar(a,1/n),a=u.rotatePoint(a,o),u.addVector(r,a)}function y(t,e){if(null==e)return!0;let i=!1,r=!1,n=!1,o=!1;return(null==e.max||null==e.max.x||t.x<=e.max.x)&&(r=!0),(null==e.min||null==e.min.x||t.x>=e.min.x)&&(i=!0),(null==e.max||null==e.max.y||t.y<=e.max.y)&&(n=!0),(null==e.min||null==e.min.y||t.y>=e.min.y)&&(o=!0),i&&r&&n&&o}function g(t,e){if(y(t,e)||null==e)return t;let i={x:t.x,y:t.y},r=e.min;return null!=r&&(null!=r.x&&(i.x=Math.max(i.x,r.x)),null!=r.y&&(i.y=Math.max(i.y,r.y))),r=e.max,null!=r&&(null!=r.x&&(i.x=Math.min(i.x,r.x)),null!=r.y&&(i.y=Math.min(i.y,r.y))),i}function b(t){if(null!=t&&null!=t.min&&null!=t.max&&null!=t.min.x&&null!=t.max.x)return t.max.x-t.min.x}function x(t){if(null!=t&&null!=t.min&&null!=t.max&&null!=t.min.y&&null!=t.max.y)return t.max.y-t.min.y}function v(t,e,i,r,n,o){if(null==r)return t;let s=d(t,{x:0,y:i},e,i,n,o),a=d(t,{x:0,y:0},e,i,n,o),l=d(t,{x:e,y:i},e,i,n,o),c=d(t,{x:e,y:0},e,i,n,o),h=g(s,r),m=g(l,r),y=g(a,r),b=g(c,r),x=[u.subVector(h,s),u.subVector(m,l),u.subVector(y,a),u.subVector(b,c)],v=Math.abs(x[0].x),p=Math.abs(x[0].y),_=x[0];return x.forEach((t=>{Math.abs(t.x)>v&&(v=Math.abs(t.x),_.x=t.x),Math.abs(t.y)>p&&(p=Math.abs(t.y),_.y=t.y)})),u.addVector(t,_)}function p(t,e){if(_(t,e)||void 0===e)return t;t=f(t);const i=z(e.start,t),r=z(e.end,t);return e.ccw&&(i<0||r>0)||!e.ccw&&(i>0||r<0)?Math.abs(i)===Math.abs(r)?e.startAsTieBreaker?e.start:e.end:Math.abs(i)<Math.abs(r)?e.start:e.end:t}function _(t,e){if(void 0===e)return!0;const i=z(e.start,t),r=z(e.end,t);return!(e.ccw&&(i<0||r>0)||!e.ccw&&(i>0||r<0))}function f(t){return((t%=2*Math.PI)+2*Math.PI)%(2*Math.PI)}function z(t,e){t=f(t);let i=(e=f(e))-t;return i>Math.PI&&(i=-(2*Math.PI-i)),i<-Math.PI&&(i+=2*Math.PI),i}class C{constructor(t=void 0){this._nextHandler=t}set nextHandler(t){this._nextHandler=t}get nextHandler(){return this._nextHandler}chainHandler(t){return this._nextHandler=t,t}panCameraTo(t,e){this._nextHandler&&this._nextHandler.panCameraTo(t,e)}panCameraBy(t,e){this._nextHandler&&this._nextHandler.panCameraBy(t,e)}}class w extends C{constructor(t=void 0){super(t)}panCameraTo(t,e){t.setPosition(e)}panCameraBy(t,e){t.setPosition(u.addVector(t.position,e))}}class S extends C{constructor(t=void 0){super(t),this._entireViewPort=!1}set entireViewPort(t){this._entireViewPort=t}get entireViewPort(){return this._entireViewPort}panCameraTo(t,e){let i=g(e,t.boundaries);this._entireViewPort&&(i=v(e,t.viewPortWidth,t.viewPortHeight,t.boundaries,t.zoomLevel,t.rotation)),super.panCameraTo(t,i)}panCameraBy(t,e){let i=u.subVector(g(u.addVector(t.position,e),t.boundaries),t.position);this._entireViewPort&&(i=u.subVector(v(u.addVector(t.position,e),t.viewPortWidth,t.viewPortHeight,t.boundaries,t.zoomLevel,t.rotation),t.position)),super.panCameraBy(t,i)}}class V extends C{constructor(t=void 0){super(t),this._restrictXTranslation=!1,this._restrictYTranslation=!1,this._restrictRelativeXTranslation=!1,this._restrictRelativeYTranslation=!1}set restrictXTranslation(t){this._restrictXTranslation=t}get restrictXTranslation(){return this._restrictXTranslation}set restrictYTranslation(t){this._restrictYTranslation=t}get restrictYTranslation(){return this._restrictYTranslation}set restrictRelativeXTranslation(t){this._restrictRelativeXTranslation=t}get restrictRelativeXTranslation(){return this._restrictRelativeXTranslation}set restrictRelativeYTranslation(t){this._restrictRelativeYTranslation=t}get restrictRelativeYTranslation(){return this._restrictRelativeYTranslation}convertDeltaToComplyWithRestriction(t,e){if(this._restrictXTranslation&&this._restrictYTranslation)return{x:0,y:0};if(this._restrictRelativeXTranslation&&this._restrictRelativeYTranslation)return{x:0,y:0};if(this._restrictXTranslation&&(e.x=0),this._restrictYTranslation&&(e.y=0),this._restrictRelativeXTranslation){const i=u.rotatePoint({x:0,y:1},t.rotation),r=u.dotProduct(i,e);e=u.multiplyVectorByScalar(i,r)}if(this._restrictRelativeYTranslation){const i=u.rotatePoint({x:1,y:0},t.rotation),r=u.dotProduct(i,e);e=u.multiplyVectorByScalar(i,r)}return e}panCameraTo(t,e){let i=u.subVector(e,t.position);if(i=this.convertDeltaToComplyWithRestriction(t,i),0===i.x&&0===i.y)return;const r=u.addVector(t.position,i);super.panCameraTo(t,r)}panCameraBy(t,e){e=this.convertDeltaToComplyWithRestriction(t,e),super.panCameraBy(t,e)}}class P extends C{set restrictRelativeXTranslation(t){this.restrictionHandler.restrictRelativeXTranslation=t}set restrictRelativeYTranslation(t){this.restrictionHandler.restrictRelativeYTranslation=t}set restrictXTranslation(t){this.restrictionHandler.restrictXTranslation=t}set restrictYTranslation(t){this.restrictionHandler.restrictYTranslation=t}set restrictTranslation(t){this.restrictionHandler.restrictXTranslation=t,this.restrictionHandler.restrictYTranslation=t}get restrictTranslation(){return this.restrictionHandler.restrictXTranslation}get restrictXTranslation(){return this.restrictionHandler.restrictXTranslation}get restrictYTranslation(){return this.restrictionHandler.restrictYTranslation}get restrictRelativeXTranslation(){return this.restrictionHandler.restrictRelativeXTranslation}get restrictRelativeYTranslation(){return this.restrictionHandler.restrictRelativeYTranslation}set limitEntireViewPort(t){this.clampHandler.entireViewPort=t}get limitEntireViewPort(){return this.clampHandler.entireViewPort}constructor(){super(),this.baseHandler=new w,this.clampHandler=new S,this.restrictionHandler=new V,this.restrictionHandler.chainHandler(this.clampHandler).chainHandler(this.baseHandler),this.nextHandler=this.restrictionHandler}}class H{constructor(t=void 0){this._nextHandler=t}set nextHandler(t){this._nextHandler=t}get nextHandler(){return this._nextHandler}chainHandler(t){return this._nextHandler=t,t}rotateCameraTo(t,e){this._nextHandler&&this._nextHandler.rotateCameraTo(t,e)}rotateCameraBy(t,e){this._nextHandler&&this._nextHandler.rotateCameraBy(t,e)}}class B extends H{constructor(t=void 0){super()}rotateCameraTo(t,e){e=f(e),t.setRotation(e)}rotateCameraBy(t,e){const i=t.rotation,r=f(i+e);e=z(i,r),t.setRotation(r)}}class M extends H{constructor(t=void 0){super(t),this._restrictRotation=!1}get restrictRotation(){return this._restrictRotation}set restrictRotation(t){this._restrictRotation=t}rotateCameraBy(t,e){this._restrictRotation||super.rotateCameraBy(t,e)}rotateCameraTo(t,e){this._restrictRotation||super.rotateCameraTo(t,e)}}class L extends H{constructor(t=void 0){super(t)}rotateCameraBy(t,e){const i=t.rotation;let r=f(i+e);r=p(r,t.rotationBoundaries),e=z(i,r),super.rotateCameraBy(t,e)}rotateCameraTo(t,e){e=p(e=f(e),t.rotationBoundaries),super.rotateCameraTo(t,e)}}class O extends H{get restrictRotation(){return this._restrictionHandler.restrictRotation}set restrictRotation(t){this._restrictionHandler.restrictRotation=t}constructor(t=void 0){super(t),this._baseHandler=new B,this._clampHandler=new L(this._baseHandler),this._restrictionHandler=new M(this._clampHandler)}rotateCameraBy(t,e){this._restrictionHandler.rotateCameraBy(t,e),super.rotateCameraBy(t,e)}rotateCameraTo(t,e){this._restrictionHandler.rotateCameraTo(t,e),super.rotateCameraTo(t,e)}}class T{constructor(t=void 0){this._nextHandler=t}set nextHandler(t){this._nextHandler=t}get nextHandler(){return this._nextHandler}chainHandler(t){return this._nextHandler=t,t}zoomCameraTo(t,e){this._nextHandler&&this._nextHandler.zoomCameraTo(t,e)}zoomCameraBy(t,e){this._nextHandler&&this._nextHandler.zoomCameraBy(t,e)}zoomCameraToAt(t,e,i){this._nextHandler&&this._nextHandler.zoomCameraToAt(t,e,i)}zoomCameraByAt(t,e,i){this._nextHandler&&this._nextHandler.zoomCameraByAt(t,e,i)}}class A extends T{constructor(t,e=void 0){super(e),this.panHandler=t}set nextHandler(t){this._nextHandler=void 0}zoomCameraTo(t,e){t.setZoomLevel(e)}zoomCameraBy(t,e){const i=t.zoomLevel+e;t.setZoomLevel(i)}zoomCameraToAt(t,e,i){let r=m(i,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);t.zoomLevel,t.setZoomLevel(e);let n=m(i,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);const o=u.subVector(r,n);this.panHandler.panCameraBy(t,o)}zoomCameraByAt(t,e,i){let r=m(i,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);const n=t.zoomLevel+e;t.setZoomLevel(n);let o=m(i,t.viewPortWidth,t.viewPortHeight,t.position,t.zoomLevel,t.rotation);const s=u.subVector(r,o);this.panHandler.panCameraBy(t,s)}}class k extends T{constructor(t=void 0){super(t)}zoomCameraTo(t,e){e=c(e,t.zoomBoundaries),super.zoomCameraTo(t,e)}zoomCameraBy(t,e){let i=t.zoomLevel+e;i=c(i,t.zoomBoundaries),e=i-t.zoomLevel,super.zoomCameraBy(t,e)}zoomCameraToAt(t,e,i){e=c(e,t.zoomBoundaries),super.zoomCameraToAt(t,e,i)}zoomByAt(t,e,i){let r=t.zoomLevel+e;r=c(r,t.zoomBoundaries),e=r-t.zoomLevel,super.zoomCameraByAt(t,e,i)}}class I extends T{constructor(t=void 0){super(t),this._restrictZoom=!1}set restrictZoom(t){this._restrictZoom=t}get restrictZoom(){return this._restrictZoom}zoomCameraTo(t,e){this._restrictZoom||super.zoomCameraTo(t,e)}zoomCameraBy(t,e){this._restrictZoom||super.zoomCameraBy(t,e)}zoomCameraToAt(t,e,i){this._restrictZoom||super.zoomCameraToAt(t,e,i)}zoomCameraByAt(t,e,i){this._restrictZoom||super.zoomCameraByAt(t,e,i)}}class E extends T{constructor(t,e=void 0){super(e),this._baseHandler=new A(t),this._clampHandler=new k,this._restrictionHandler=new I,this._restrictionHandler.chainHandler(this._clampHandler).chainHandler(this._baseHandler),this._nextHandler=this._restrictionHandler}set restrictZoom(t){this._restrictionHandler.restrictZoom=t}get restrictZoom(){return this._restrictionHandler.restrictZoom}zoomCameraTo(t,e){super.zoomCameraTo(t,e)}zoomCameraBy(t,e){super.zoomCameraBy(t,e)}zoomCameraByAt(t,e,i){super.zoomCameraByAt(t,e,i)}zoomCameraToAt(t,e,i){super.zoomCameraToAt(t,e,i)}}function R(t,e,i,r){return new(i||(i=Promise))((function(n,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class D{constructor(){this.panCallbackList=[],this.zoomCallbackList=[],this.rotateCallbackList=[]}notifyPositionChange(t,e){return R(this,void 0,void 0,(function*(){queueMicrotask((()=>{this.panCallbackList.forEach((i=>{i({diff:t},e)}))}))}))}notifyZoomChange(t,e){return R(this,void 0,void 0,(function*(){return new Promise(((i,r)=>{this.zoomCallbackList.forEach((i=>{i({deltaZoomAmount:t},e)})),i()}))}))}notifyRotationChange(t,e){return R(this,void 0,void 0,(function*(){return new Promise(((i,r)=>{this.rotateCallbackList.forEach((i=>{i({deltaRotation:t},e)})),i()}))}))}on(t,e){switch(t){case"pan":return this.panCallbackList.push(e),()=>{this.panCallbackList=this.panCallbackList.filter((t=>t!==e))};case"zoom":return this.zoomCallbackList.push(e),()=>{this.zoomCallbackList=this.zoomCallbackList.filter((t=>t!==e))};case"rotate":return this.rotateCallbackList.push(e),()=>{this.rotateCallbackList=this.rotateCallbackList.filter((t=>t!==e))}}return()=>{}}clearCallbacks(){this.panCallbackList=[],this.zoomCallbackList=[],this.rotateCallbackList=[]}}class F{constructor(t=new D,e={x:0,y:0},i=1e3,r=1e3,n=1,o=0){this._position=e,this._zoomLevel=n,this._rotation=o,this._viewPortHeight=r,this._viewPortWidth=i,this._observer=t}get boundaries(){return this._boundaries}set boundaries(t){this._boundaries=t}get viewPortWidth(){return this._viewPortWidth}set viewPortWidth(t){this._viewPortWidth=t}get viewPortHeight(){return this._viewPortHeight}set viewPortHeight(t){this._viewPortHeight=t}get position(){return this._position}get observer(){return this._observer}setPosition(t){if(y(t,this._boundaries)){const e=u.subVector(t,this._position);if(u.magnitude(e)<1e-9&&u.magnitude(e)<1/this._zoomLevel)return;this._position=t,this._observer.notifyPositionChange(e,{position:this._position,rotation:this._rotation,zoomLevel:this._zoomLevel})}}get zoomLevel(){return this._zoomLevel}get zoomBoundaries(){return this._zoomBoundaries}set zoomBoundaries(t){if(void 0!==t&&void 0!==t.min&&void 0!==t.max&&t.min>t.max){let e=t.max;t.max=t.min,t.min=e}this._zoomBoundaries=t}setMaxZoomLevel(t){return null==this._zoomBoundaries&&(this._zoomBoundaries={min:void 0,max:void 0}),!(null!=this._zoomBoundaries.min&&this._zoomBoundaries.min>t||this._zoomLevel>t||(this._zoomBoundaries.max=t,0))}setMinZoomLevel(t){return null==this._zoomBoundaries&&(this._zoomBoundaries={min:void 0,max:void 0}),!(null!=this._zoomBoundaries.max&&this._zoomBoundaries.max<t||(this._zoomBoundaries.min=t,this._zoomLevel<t&&(this._zoomLevel=t),0))}setZoomLevel(t){if(h(t,this._zoomBoundaries)){if(void 0!==this._zoomBoundaries&&void 0!==this._zoomBoundaries.max&&c(t,this._zoomBoundaries)==this._zoomBoundaries.max&&this._zoomLevel==this._zoomBoundaries.max)return;if(void 0!==this._zoomBoundaries&&void 0!==this._zoomBoundaries.min&&c(t,this._zoomBoundaries)==this._zoomBoundaries.min&&this._zoomLevel==this._zoomBoundaries.min)return;const e=this._zoomLevel;this._zoomLevel=t,this._observer.notifyZoomChange(this._zoomLevel-e,{position:this._position,rotation:this._rotation,zoomLevel:this._zoomLevel})}}get rotation(){return this._rotation}get rotationBoundaries(){return this._rotationBoundaries}set rotationBoundaries(t){if(void 0!==t&&void 0!==t.start&&void 0!==t.end&&t.start>t.end){let e=t.end;t.end=t.start,t.start=e}this._rotationBoundaries=t}setRotation(t){if(_(t,this._rotationBoundaries)){if(t=f(t),void 0!==this._rotationBoundaries&&void 0!==this._rotationBoundaries.end&&p(t,this._rotationBoundaries)==this._rotationBoundaries.end&&this._rotation==this._rotationBoundaries.end)return;if(void 0!==this._rotationBoundaries&&void 0!==this.rotationBoundaries.start&&p(t,this._rotationBoundaries)==this._rotationBoundaries.start&&this._rotation==this._rotationBoundaries.start)return;this._observer.notifyRotationChange(t-this._rotation,{position:this._position,rotation:t,zoomLevel:this._zoomLevel}),this._rotation=t}}convertFromViewPort2WorldSpace(t){return m(t,this._viewPortWidth,this._viewPortHeight,this._position,this._zoomLevel,this._rotation)}invertFromWorldSpace2ViewPort(t){let e={x:this.viewPortWidth/2,y:this._viewPortHeight/2},i=u.subVector(t,this._position);return i=u.rotatePoint(i,-this._rotation),i=u.multiplyVectorByScalar(i,this._zoomLevel),u.addVector(e,i)}setHorizontalBoundaries(t,e){if(t>e){let i=e;e=t,t=i}null==this._boundaries&&(this._boundaries={min:{x:void 0,y:void 0},max:{x:void 0,y:void 0}}),this._boundaries.min.x=t,this._boundaries.max.x=e}setVerticalBoundaries(t,e){if(t>e){let i=e;e=t,t=i}null==this._boundaries&&(this._boundaries={min:{x:void 0,y:void 0},max:{x:void 0,y:void 0}}),this._boundaries.min.y=t,this._boundaries.max.y=e}on(t,e){return this._observer.on(t,e)}}class W{constructor(t,e,i,r=!1,n=!0){this._panDisabled=!1,this._zoomDisabled=!1,this._rotateDisabled=!1,this._keyController=new Map,this.SCROLL_SENSATIVITY=.005,this.isDragging=!1,this._canvas=t,this._camera=e,this._debugMode=r,this._alignCoordinateSystem=n,this.bindFunctions(),this.inputObserver=i}get debugMode(){return this._debugMode}set debugMode(t){this._debugMode=t}get alignCoordinateSystem(){return this._alignCoordinateSystem}set alignCoordinateSystem(t){this._alignCoordinateSystem=t}get panDisabled(){return this._panDisabled}set panDisabled(t){this._panDisabled=t,t&&(this.canvas.style.cursor="auto",this.isDragging=!1,this.dragStartPoint={x:0,y:0})}get zoomDisabled(){return this._zoomDisabled}set zoomDisabled(t){this._zoomDisabled=t}get rotateDisabled(){return this._rotateDisabled}set rotateDisabled(t){this._rotateDisabled=t}get camera(){return this._camera}set camera(t){this._camera=t}get canvas(){return this._canvas}setUp(){this.canvas.addEventListener("pointerdown",this.pointerDownHandler),this.canvas.addEventListener("pointerup",this.pointerUpHandler),this.canvas.addEventListener("pointermove",this.pointerMoveHandler),this.canvas.addEventListener("wheel",this.scrollHandler),window.addEventListener("keydown",this.keypressHandler),window.addEventListener("keyup",this.keyupHandler),this.setupKeyController([" "])}tearDown(){this.canvas.removeEventListener("pointerdown",this.pointerDownHandler),this.canvas.removeEventListener("pointerup",this.pointerUpHandler),this.canvas.removeEventListener("pointermove",this.pointerMoveHandler),this.canvas.removeEventListener("wheel",this.scrollHandler),window.removeEventListener("keydown",this.keypressHandler),window.removeEventListener("keyup",this.keyupHandler)}bindFunctions(){this.pointerDownHandler=this.pointerDownHandler.bind(this),this.pointerUpHandler=this.pointerUpHandler.bind(this),this.pointerMoveHandler=this.pointerMoveHandler.bind(this),this.scrollHandler=this.scrollHandler.bind(this),this.keypressHandler=this.keypressHandler.bind(this),this.keyupHandler=this.keyupHandler.bind(this)}setupKeyController(t){t.forEach((t=>{this._keyController.set(t,!1)}))}pointerDownHandler(t){this._disabled||"mouse"!==t.pointerType||1!=t.button&&!t.metaKey&&!this._keyController.get(" ")||this._panDisabled||(this.isDragging=!0,this.dragStartPoint={x:t.clientX,y:t.clientY})}disableStrategy(){this.isDragging=!1,this.dragStartPoint={x:0,y:0},this._disabled=!0}enableStrategy(){this._disabled=!1}pointerUpHandler(t){this._disabled||"mouse"===t.pointerType&&(this.isDragging&&(this.isDragging=!1),this._debugMode?this.canvas.style.cursor="none":this.canvas.style.cursor="auto")}pointerMoveHandler(t){if(!this._disabled&&"mouse"==t.pointerType&&this.isDragging&&!this._panDisabled){this._debugMode?this.canvas.style.cursor="none":this.canvas.style.cursor="grabbing";const e={x:t.clientX,y:t.clientY};let i=u.subVector(this.dragStartPoint,e);this._alignCoordinateSystem||(i=u.flipYAxis(i));let r=u.rotatePoint(i,this._camera.rotation);r=u.multiplyVectorByScalar(r,1/this._camera.zoomLevel),this.inputObserver.notifyOnPan(this._camera,r),this.dragStartPoint=e}}scrollHandler(t){if(this._disabled)return;t.preventDefault();const e=t.deltaY*this.SCROLL_SENSATIVITY;if(t.ctrlKey){if(this._zoomDisabled)return;const i={x:t.clientX,y:t.clientY};let r=u.subVector(i,{x:this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().top});this._alignCoordinateSystem||(r=u.subVector(i,{x:this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().bottom}),r=u.flipYAxis(r)),this.inputObserver.notifyOnZoom(this._camera,-this._camera.zoomLevel*e*5,r)}else{if(this._panDisabled)return;let e={x:t.deltaX,y:t.deltaY};this._alignCoordinateSystem||(e=u.flipYAxis(e));let i=u.rotatePoint(e,this._camera.rotation);i=u.multiplyVectorByScalar(i,1/this._camera.zoomLevel),this.inputObserver.notifyOnPan(this._camera,i)}}keypressHandler(t){this._keyController.has(t.key)&&0==this._keyController.get(t.key)&&(t.preventDefault(),this._keyController.set(t.key,!0))}keyupHandler(t){this._keyController.has(t.key)&&1==this._keyController.get(t.key)&&(t.preventDefault(),this._keyController.set(t.key,!1),this.isDragging=!1,this.canvas.style.cursor="auto")}updateCamera(t){this._camera=t}get disabled(){return this._disabled}}class Y{constructor(t,e,i,r=!0){this._panDisabled=!1,this._zoomDisabled=!1,this._rotateDisabled=!1,this.isDragging=!1,this.ZOOM_SENSATIVITY=.005,this.panInputCallBackList=[],this.zoomInputCallBackList=[],this.controlCamera=e,this.canvas=t,this._disabled=!1,this.touchPoints=[],this.zoomStartDist=0,this.isDragging=!1,this.dragStartPoint={x:0,y:0},this._alignCoordinateSystem=r,this.inputObserver=i,this.bindListeners()}bindListeners(){this.touchstartHandler=this.touchstartHandler.bind(this),this.touchendHandler=this.touchendHandler.bind(this),this.touchcancelHandler=this.touchcancelHandler.bind(this),this.touchmoveHandler=this.touchmoveHandler.bind(this)}resetAttributes(){this.touchPoints=[],this.zoomStartDist=0,this.isDragging=!1,this.dragStartPoint=null,this.tapPoint=null}enableStrategy(){this._disabled=!1}disableStrategy(){this.resetAttributes(),this._disabled=!0}setUp(){this.canvas.addEventListener("touchstart",this.touchstartHandler),this.canvas.addEventListener("touchend",this.touchendHandler),this.canvas.addEventListener("touchcancel",this.touchcancelHandler),this.canvas.addEventListener("touchmove",this.touchmoveHandler)}tearDown(){this.resetAttributes(),this.canvas.removeEventListener("touchstart",this.touchstartHandler),this.canvas.removeEventListener("touchend",this.touchendHandler),this.canvas.removeEventListener("touchcancel",this.touchcancelHandler),this.canvas.removeEventListener("touchmove",this.touchmoveHandler)}get disabled(){return this._disabled}get alignCoordinateSystem(){return this._alignCoordinateSystem}set alignCoordinateSystem(t){this._alignCoordinateSystem=t}get panDisabled(){return this._panDisabled}set panDisabled(t){this._panDisabled=t}get zoomDisabled(){return this._zoomDisabled}set zoomDisabled(t){this._zoomDisabled=t}get rotateDisabled(){return this._rotateDisabled}set rotateDisabled(t){this._rotateDisabled=t}get camera(){return this.controlCamera}set camera(t){this.controlCamera=t}updateCamera(t){this.controlCamera=t}touchstartHandler(t){if(!this._disabled)if(t.preventDefault(),2===t.targetTouches.length){this.isDragging=!1;let e={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY},i={x:t.targetTouches[1].clientX,y:t.targetTouches[1].clientY};this.zoomStartDist=u.distanceBetweenPoints(e,i),this.touchPoints=[e,i]}else 1===t.targetTouches.length&&(this.tapPoint={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY},this.tapPoint=this.controlCamera.convertFromViewPort2WorldSpace(this.convertWindowPoint2ViewPortPoint({x:this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().top},this.tapPoint)),this.isDragging=!0,this.dragStartPoint={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY})}touchcancelHandler(t){this._disabled||(this.isDragging=!1,this.touchPoints=[])}touchendHandler(t){this._disabled||(this.isDragging=!1,this.touchPoints=[])}touchmoveHandler(t){if(!this._disabled)if(t.preventDefault(),2==t.targetTouches.length&&2==this.touchPoints.length){if(this._zoomDisabled)return;let e={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY},i={x:t.targetTouches[1].clientX,y:t.targetTouches[1].clientY},r=u.distanceBetweenPoints(e,i),n=this.zoomStartDist-r,o=u.linearInterpolation(e,i,.5);o=this._alignCoordinateSystem?this.convertWindowPoint2ViewPortPoint({x:this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().top},o):this.convertWindowPoint2ViewPortPoint({x:this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().bottom},o);let s=.1*n*this.controlCamera.zoomLevel*this.ZOOM_SENSATIVITY;this.inputObserver.notifyOnZoom(this.controlCamera,-s,o),this.touchPoints=[e,i],this.tapPoint=null}else if(1==t.targetTouches.length&&this.isDragging&&!this._panDisabled){let e={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY},i=u.subVector(this.dragStartPoint,e);this._alignCoordinateSystem||(i=u.flipYAxis(i));let r=u.rotatePoint(i,this.controlCamera.rotation);r=u.multiplyVectorByScalar(r,1/this.controlCamera.zoomLevel),this.inputObserver.notifyOnPan(this.controlCamera,r),this.dragStartPoint=e,this.tapPoint=null}}convertWindowPoint2ViewPortPoint(t,e){const i=u.subVector(e,t);return this._alignCoordinateSystem?{x:i.x,y:i.y}:{x:i.x,y:-i.y}}}function Z(t,e){return null!=e&&(null==t||e!=1/0&&void 0!==t&&(null==t.min||e>t.min))}function X(t,e,i,r){const n=b(t);if(null==n)return;const o=Math.abs(n*Math.cos(r)),s=Math.abs(n*Math.sin(r));return e/o==1/0?i/s:Math.max(e/o,i/s)}function j(t,e,i,r){const n=x(t);if(null==n)return;const o=e/Math.abs(n*Math.cos(r)),s=i/Math.abs(n*Math.sin(r));return s==1/0?o:Math.max(o,s)}class U{constructor(t){this.cameraSubscribers=[],this.panHandlerSubscribers=[],this.zoomHandlerSubscribers=[],this.rotationHandlerSubscribers=[],this._camera=t}subscribeToCamera(t){this.cameraSubscribers.push(t)}unsubscribeToCamera(t){this.cameraSubscribers=this.cameraSubscribers.filter((e=>e!==t))}subscribeToPanHandler(t){this.panHandlerSubscribers.push(t)}unsubscribeToPanHandler(t){this.panHandlerSubscribers=this.panHandlerSubscribers.filter((e=>e!==t))}subscribeToZoomHandler(t){this.zoomHandlerSubscribers.push(t)}unsubscribeToZoomHandler(t){this.zoomHandlerSubscribers=this.zoomHandlerSubscribers.filter((e=>e!==t))}subscribeToRotationHandler(t){return this.rotationHandlerSubscribers.push(t),()=>{this.rotationHandlerSubscribers=this.rotationHandlerSubscribers.filter((e=>e!==t))}}get camera(){return this._camera}set camera(t){this._camera=t,this.notifyCameraChange()}get panHandler(){return this._panHandler}set panHandler(t){this._panHandler=t,this.notifyPanHandlerChange()}get zoomHandler(){return this._zoomHandler}set zoomHandler(t){this._zoomHandler=t,this.notifyZoomHandlerChange()}get rotationHandler(){return this._rotationHandler}set rotationHandler(t){this._rotationHandler=t,this.notifyRotationHandlerChange()}notifyCameraChange(){this.cameraSubscribers.forEach((t=>t.updateCamera(this._camera)))}notifyPanHandlerChange(){this.panHandlerSubscribers.forEach((t=>t.updatePanHandler(this._panHandler)))}notifyZoomHandlerChange(){this.zoomHandlerSubscribers.forEach((t=>t.updateZoomHandler(this._zoomHandler)))}notifyRotationHandlerChange(){this.rotationHandlerSubscribers.forEach((t=>t.updateRotationHandler(this._rotationHandler)))}}class q{constructor(t){this.panCallbackList=[],this.zoomCallbackList=[],this.rotateCallbackList=[],this._controlCenter=t}notifyOnPan(t,e){this._controlCenter.notifyPanInput(t,e),this.panCallbackList.forEach((t=>{queueMicrotask((()=>{t({diff:e})}))}))}notifyOnZoom(t,e,i){this._controlCenter.notifyZoomInput(t,e,i),this.zoomCallbackList.forEach((t=>{queueMicrotask((()=>{t({deltaZoomAmount:e,anchorPoint:i})}))}))}notifyOnRotation(t,e){this._controlCenter.notifyRotationInput(t,e),this.rotateCallbackList.forEach((t=>{queueMicrotask((()=>{t({deltaRotation:e})}))}))}onInput(t,e){switch(t){case"pan":return this.panCallbackList.push(e),()=>{this.panCallbackList=this.panCallbackList.filter((t=>t!==e))};case"zoom":return this.zoomCallbackList.push(e),()=>{this.zoomCallbackList=this.zoomCallbackList.filter((t=>t!==e))};case"rotate":return this.rotateCallbackList.push(e),()=>{this.rotateCallbackList=this.rotateCallbackList.filter((t=>t!==e))};default:throw new Error("Invalid input event name")}}get controlCenter(){return this._controlCenter}set controlCenter(t){this._controlCenter=t}}class K{constructor(t,e,i){this._panController=t,this._zoomController=e,this._rotationController=i}get panController(){return this._panController}get zoomController(){return this._zoomController}get rotationController(){return this._rotationController}notifyPanInput(t,e){this._panController.panCameraBy(t,e)}notifyZoomInput(t,e,i){this._zoomController.zoomCameraToAt(t,t.zoomLevel+e,i)}notifyRotationInput(t,e){this._rotationController.rotateCameraBy(t,e)}}function Q(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}Object.freeze({__proto__:null,easeInBack:function(t){return 2.70158*t*t*t-1.70158*t*t},easeInBounce:function(t){return 1-Q(1-t)},easeInCirc:function(t){return 1-Math.sqrt(1-Math.pow(t,2))},easeInCubic:function(t){return t*t*t},easeInElastic:function(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*e)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*t-10)},easeInOutBack:function(t){const e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2},easeInOutBounce:function(t){return t<.5?(1-Q(1-2*t))/2:(1+Q(2*t-1))/2},easeInOutCirc:function(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2},easeInOutCubic:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2},easeInOutElastic:function(t){const e=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1},easeInOutExpo:function(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2},easeInOutQuad:function(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2},easeInOutSine:function(t){return-(Math.cos(Math.PI*t)-1)/2},easeInQuad:function(t){return t*t},easeInQuart:function(t){return t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeInSine:function(t){return 1-Math.cos(t*Math.PI/2)},easeOutBack:function(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)},easeOutBounce:Q,easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeOutCubic:function(t){return 1-Math.pow(1-t,3)},easeOutElastic:function(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},easeOutQuad:function(t){return 1-(1-t)*(1-t)},easeOutQuart:function(t){return 1-Math.pow(1-t,4)},easeOutQuint:function(t){return 1-Math.pow(1-t,5)},easeOutSine:function(t){return Math.sin(t*Math.PI/2)},linear:function(t){return t}});const N=new class{constructor(t,e){this.pinJoints=[],this._context=null,this.maxTransHeight=e,this.maxTransWidth=t,this.bound=new i({x:-this.maxTransWidth,y:-this.maxTransHeight},2*this.maxTransWidth,2*this.maxTransHeight),this.quadTree=new r(0,this.bound),this.rigidBodyList=[],this.rigidBodyMap=new Map,this._resolveCollision=!0,this.constraints=[]}addRigidBody(t,e){this.rigidBodyList.push(e),this.rigidBodyMap.set(t,e)}removeRigidBody(t){this.rigidBodyMap.has(t)&&this.rigidBodyMap.delete(t)}step(t){this._resolveCollision&&this.resolveCollisionPhase(),this.constraints.forEach((e=>e.enforce(t))),this.getRigidBodyList().forEach((e=>{e.step(t)}))}resolveCollisionPhase(){let t=[];return this.quadTree.clear(),this.rigidBodyMap.forEach((e=>{t.push(e),this.quadTree.insert(e)})),e(0,function(t,e){let i=[];for(let o=0;o<=e.length-1;o++){let s=t.retrieve(e[o]);for(let t=0;t<=s.length-1;t++){let a=e[o],l=s[t];a.isStatic()&&l.isStatic()||(r=a.AABB,n=l.AABB,r.min.x<=n.max.x&&n.min.x<=r.max.x&&r.min.y<=n.max.y&&n.min.y<=r.max.y&&i.push({bodyA:a,bodyB:l}))}}var r,n;return i}(this.quadTree,t),this._resolveCollision)}get resolveCollision(){return this._resolveCollision}set resolveCollision(t){this._resolveCollision=t}getRigidBodyList(){let t=[];return this.rigidBodyMap.forEach((e=>{t.push(e)})),t}getRigidBodyMap(){return this.rigidBodyMap}setMaxTransHeight(t){this.maxTransHeight=t}setMaxTransWidth(t){this.maxTransWidth=t}addConstraint(t){this.constraints.push(t)}getConstraints(){return this.constraints}addPinJoint(t,e,i,r){this.pinJoints.push({bodyA:t,bodyB:e,anchorA:i,anchorB:r})}}(1e3,1e3);N.resolveCollision=!1;const J=document.getElementById("test-graph"),G=new class{constructor(t){this._alignCoordinateSystem=!0,this._fullScreen=!1,this.lastUpdateTime=0,this._canvas=t,this.boardStateObserver=new U(new F),this.boardStateObserver.camera.viewPortHeight=t.height,this.boardStateObserver.camera.viewPortWidth=t.width,this.boardStateObserver.camera.boundaries={min:{x:-5e3,y:-5e3},max:{x:5e3,y:5e3}};let e=t.getContext("2d");if(null==e)throw new Error("Canvas 2d context is null");this._context=e;let i=new P,r=new E(i),n=new O;this.bindFunctions(),this.attributeObserver=new MutationObserver(this.attributeCallBack),this.attributeObserver.observe(this._canvas,{attributes:!0}),this.windowResizeObserver=new ResizeObserver(this.windowResizeHandler),this.windowResizeObserver.observe(document.body),this.boardInputObserver=new q(new K(i,r,n)),this._kmtStrategy=new W(this._canvas,this.boardStateObserver.camera,this.boardInputObserver),this.boardStateObserver.subscribeToCamera(this._kmtStrategy),this._touchStrategy=new Y(this._canvas,this.boardStateObserver.camera,this.boardInputObserver),this.boardStateObserver.subscribeToCamera(this._touchStrategy),this.registerEventListeners()}registerEventListeners(){this._kmtStrategy.setUp(),this._touchStrategy.setUp()}removeEventListeners(){this._touchStrategy.tearDown(),this._kmtStrategy.tearDown()}setup(){this.registerEventListeners(),this.windowResizeObserver.observe(document.body),this.attributeObserver.observe(this._canvas,{attributes:!0})}tearDown(){this.removeEventListeners(),this.windowResizeObserver.disconnect(),this.attributeObserver.disconnect()}bindFunctions(){this.step=this.step.bind(this),this.attributeCallBack=this.attributeCallBack.bind(this),this.windowResizeHandler=this.windowResizeHandler.bind(this)}set width(t){if(this._canvas.width=t,this.boardStateObserver.camera.viewPortWidth=t,this.boardInputObserver.controlCenter.panController.limitEntireViewPort){const t=X(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);null!=t&&Z(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}get width(){return this._canvas.width}set height(t){if(this._canvas.height=t,this.boardStateObserver.camera.viewPortHeight=t,this.boardInputObserver.controlCenter.panController.limitEntireViewPort){const t=j(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);null!=t&&Z(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}get height(){return this._canvas.height}set alignCoordinateSystem(t){this._alignCoordinateSystem=t,this._kmtStrategy.alignCoordinateSystem=t,this._touchStrategy.alignCoordinateSystem=t}get alignCoordinateSystem(){return this._alignCoordinateSystem}get fullScreen(){return this._fullScreen}set fullScreen(t){this._fullScreen=t,this._fullScreen&&(this.width=window.innerWidth,this.height=window.innerHeight)}get context(){return this._context}set limitEntireViewPort(t){if(this.boardInputObserver.controlCenter.panController.limitEntireViewPort=t,t){const t=function(t,e,i,r){const n=b(t),o=x(t);if(null==n||null==o)return;let s=e/Math.abs(n*Math.cos(r)),a=e/Math.abs(o*Math.cos(r)),l=i/Math.abs(n*Math.sin(r)),c=i/Math.abs(o*Math.sin(r));s==1/0&&(s=0),a==1/0&&(a=0),l==1/0&&(l=0),c==1/0&&(c=0);const h=i/o,u=e/n;return Math.max(h,u,s,a,l,c)}(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);null!=t&&Z(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}get limitEntireViewPort(){return this.boardInputObserver.controlCenter.panController.limitEntireViewPort}set kmtStrategy(t){this._kmtStrategy.tearDown(),this.boardStateObserver.unsubscribeToCamera(this._kmtStrategy),t.setUp(),this._kmtStrategy=t,this.boardStateObserver.subscribeToCamera(this._kmtStrategy),this._kmtStrategy.camera=this.boardStateObserver.camera}get kmtStrategy(){return this._kmtStrategy}set touchStrategy(t){this._touchStrategy.tearDown(),this.boardStateObserver.unsubscribeToCamera(this._touchStrategy),t.setUp(),this._touchStrategy=t,this.boardStateObserver.subscribeToCamera(this._touchStrategy),this._touchStrategy.camera=this.boardStateObserver.camera}get touchStrategy(){return this._touchStrategy}get camera(){return this.boardStateObserver.camera}set camera(t){t.viewPortHeight=this._canvas.height,t.viewPortWidth=this._canvas.width,this.boardStateObserver.camera=t}set panHandler(t){this.boardInputObserver.controlCenter.panController=t}get panHandler(){return this.boardInputObserver.controlCenter.panController}set zoomHandler(t){this.boardStateObserver.zoomHandler=t}get zoomHandler(){return this.boardStateObserver.zoomHandler}set controlCenter(t){let e=this.boardInputObserver.controlCenter.panController,i=this.boardInputObserver.controlCenter.zoomController,r=this.boardInputObserver.controlCenter.rotationController;t.panController=e,t.zoomController=i,t.rotationController=r,this.boardInputObserver.controlCenter=t}get controlCenter(){return this.boardInputObserver.controlCenter}step(t){this.lastUpdateTime,this.lastUpdateTime=t,this._context.reset();const e=this.boardStateObserver.camera.boundaries;if(!function(t){return null!=t&&null!=t.max&&null!=t.min&&null!=t.max.x&&null!=t.max.y&&null!=t.min.x&&null!=t.min.y}(e))throw new Error("Boundaries are not fully defined; not able to clear the canvas under the current implementation");this._context.clearRect(e.min.x,-e.min.y,e.max.x-e.min.x,-(e.max.y-e.min.y)),this._context.translate(this._canvas.width/2,this._canvas.height/2),this._context.scale(this.boardStateObserver.camera.zoomLevel,this.boardStateObserver.camera.zoomLevel),this._alignCoordinateSystem?(this._context.rotate(-this.boardStateObserver.camera.rotation),this._context.translate(-this.boardStateObserver.camera.position.x,-this.boardStateObserver.camera.position.y)):(this._context.rotate(this.boardStateObserver.camera.rotation),this._context.translate(-this.boardStateObserver.camera.position.x,this.boardStateObserver.camera.position.y))}convertWindowPoint2ViewPortPoint(t,e){const i=u.subVector(e,t);return this._alignCoordinateSystem?{x:i.x,y:i.y}:{x:i.x,y:-i.y}}convertWindowPoint2WorldCoord(t){if(this._alignCoordinateSystem){const e=this.convertWindowPoint2ViewPortPoint({y:this._canvas.getBoundingClientRect().top,x:this._canvas.getBoundingClientRect().left},t);return this.boardStateObserver.camera.convertFromViewPort2WorldSpace(e)}{const e=this.convertWindowPoint2ViewPortPoint({y:this._canvas.getBoundingClientRect().bottom,x:this._canvas.getBoundingClientRect().left},t);return this.boardStateObserver.camera.convertFromViewPort2WorldSpace(e)}}on(t,e){return this.boardStateObserver.camera.on(t,e)}onInput(t,e){return this.boardInputObserver.onInput(t,e)}get maxHalfTransHeight(){return function(t){const e=x(t);return null!=e?e/2:void 0}(this.boardStateObserver.camera.boundaries)}get maxHalfTransWidth(){return function(t){const e=b(t);return null!=e?e/2:void 0}(this.boardStateObserver.camera.boundaries)}attributeCallBack(t,e){for(let e of t)if("attributes"===e.type)if("width"===e.attributeName){if(this.boardStateObserver.camera.viewPortWidth=this._canvas.width,this.limitEntireViewPort){const t=X(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);Z(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}else if("height"===e.attributeName&&(this.boardStateObserver.camera.viewPortHeight=this._canvas.height,this.limitEntireViewPort)){const t=j(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);Z(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}windowResizeHandler(){this._fullScreen&&(this.width=window.innerWidth,this.height=window.innerHeight)}setMaxTransWidthAlignedMin(t){const e=this.boardStateObserver.camera.boundaries,i=null==e?void 0:e.min,r=null==i?void 0:i.x;if(null==r?this.boardStateObserver.camera.setHorizontalBoundaries(-t,t):this.boardStateObserver.camera.setHorizontalBoundaries(r,r+2*t),this.limitEntireViewPort){const t=X(this.boardStateObserver.camera.boundaries,this._canvas.width,this._canvas.height,this.boardStateObserver.camera.rotation);Z(this.boardStateObserver.camera.zoomBoundaries,t)&&this.boardStateObserver.camera.setMinZoomLevel(t)}}}(J),$={ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1,KeyQ:!1,KeyE:!1},tt=90*Math.PI/180-Math.acos(50/150),et=(Math.PI,Math.acos(50/150),{x:50,y:-150*Math.sin(90*Math.PI/180-tt)}),it=new o({x:0,y:0},[{x:.5,y:0},{x:.5,y:-150},{x:-.5,y:-150},{x:-.5,y:0}],G.context,tt,100),rt=new o({x:200,y:0},[{x:.5,y:0},{x:.5,y:-150},{x:-.5,y:-150},{x:-.5,y:0}],G.context,-tt,100),nt=new o(et,[{x:0,y:0},{x:100,y:0},{x:50,y:150*Math.sin(90*Math.PI/180-tt)}],G.context,0,100),ot=new a(it,it.center,{x:0,y:0}),st=new a(rt,{x:0,y:0},{x:200,y:0}),at=new l(nt,it,{x:0,y:0},{x:0,y:-150}),lt=new l(nt,rt,{x:100,y:0},{x:0,y:-150});N.addRigidBody("acLink",it),N.addRigidBody("bdLink",rt),N.addRigidBody("cTriangleLink",nt),N.addConstraint(ot),N.addConstraint(st),N.addConstraint(at),N.addConstraint(lt),G.fullScreen=!0,G.camera.setPosition({x:100,y:0}),G.camera.setZoomLevel(2),G.alignCoordinateSystem=!1;let ct=0;N._context=G.context,function t(e){const i=e-ct;G.step(i),$.ArrowUp&&it.applyForceInOrientation({x:0,y:-3e3}),$.ArrowDown&&it.applyForceInOrientation({x:0,y:3e3}),$.ArrowLeft&&it.applyForceInOrientation({x:-3e3,y:0}),$.ArrowRight&&it.applyForceInOrientation({x:3e3,y:0}),$.KeyQ&&(it.angularVelocity=.1),$.KeyE&&(it.angularVelocity=-.1),G.context.lineWidth=1/G.camera.zoomLevel,N.step(.016),ct=e,requestAnimationFrame(t)}(0),window.addEventListener("visibilitychange",(function(){document.hidden||(ct=performance.now())})),window.addEventListener("keydown",(function(t){"ArrowUp"===t.key&&($.ArrowUp=!0),"ArrowDown"===t.key&&($.ArrowDown=!0),"ArrowLeft"===t.key&&($.ArrowLeft=!0),"ArrowRight"===t.key&&($.ArrowRight=!0),"KeyQ"===t.code&&($.KeyQ=!0),"KeyE"===t.code&&($.KeyE=!0)})),window.addEventListener("keyup",(function(t){"ArrowUp"===t.key&&($.ArrowUp=!1),"ArrowDown"===t.key&&($.ArrowDown=!1),"ArrowLeft"===t.key&&($.ArrowLeft=!1),"ArrowRight"===t.key&&($.ArrowRight=!1),"KeyQ"===t.code&&($.KeyQ=!1),"KeyE"===t.code&&($.KeyE=!1)}))})();
//# sourceMappingURL=index.js.map